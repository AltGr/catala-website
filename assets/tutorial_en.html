<head>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.catala-code .hll { background-color: #ffffcc }
.catala-code { background: #ffffff; }
.catala-code .c { color: #888888 } /* Comment */
.catala-code .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.catala-code .k { color: #008800; font-weight: bold } /* Keyword */
.catala-code .o { color: #333333 } /* Operator */
.catala-code .ch { color: #888888 } /* Comment.Hashbang */
.catala-code .cm { color: #888888 } /* Comment.Multiline */
.catala-code .cp { color: #557799 } /* Comment.Preproc */
.catala-code .cpf { color: #888888 } /* Comment.PreprocFile */
.catala-code .c1 { color: #888888 } /* Comment.Single */
.catala-code .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.catala-code .gd { color: #A00000 } /* Generic.Deleted */
.catala-code .ge { font-style: italic } /* Generic.Emph */
.catala-code .gr { color: #FF0000 } /* Generic.Error */
.catala-code .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.catala-code .gi { color: #00A000 } /* Generic.Inserted */
.catala-code .go { color: #888888 } /* Generic.Output */
.catala-code .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.catala-code .gs { font-weight: bold } /* Generic.Strong */
.catala-code .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.catala-code .gt { color: #0044DD } /* Generic.Traceback */
.catala-code .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.catala-code .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.catala-code .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.catala-code .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.catala-code .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.catala-code .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.catala-code .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.catala-code .s { background-color: #fff0f0 } /* Literal.String */
.catala-code .na { color: #0000CC } /* Name.Attribute */
.catala-code .nb { color: #007020 } /* Name.Builtin */
.catala-code .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.catala-code .no { color: #003366; font-weight: bold } /* Name.Constant */
.catala-code .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.catala-code .ni { color: #880000; font-weight: bold } /* Name.Entity */
.catala-code .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.catala-code .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.catala-code .nl { color: #997700; font-weight: bold } /* Name.Label */
.catala-code .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.catala-code .nt { color: #007700 } /* Name.Tag */
.catala-code .nv { color: #996633 } /* Name.Variable */
.catala-code .ow { color: #000000; font-weight: bold } /* Operator.Word */
.catala-code .w { color: #bbbbbb } /* Text.Whitespace */
.catala-code .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.catala-code .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.catala-code .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.catala-code .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.catala-code .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.catala-code .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.catala-code .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.catala-code .sc { color: #0044DD } /* Literal.String.Char */
.catala-code .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.catala-code .sd { color: #DD4422 } /* Literal.String.Doc */
.catala-code .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.catala-code .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.catala-code .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.catala-code .si { background-color: #eeeeee } /* Literal.String.Interpol */
.catala-code .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.catala-code .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.catala-code .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.catala-code .ss { color: #AA6600 } /* Literal.String.Symbol */
.catala-code .bp { color: #007020 } /* Name.Builtin.Pseudo */
.catala-code .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.catala-code .vc { color: #336699 } /* Name.Variable.Class */
.catala-code .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.catala-code .vi { color: #3333BB } /* Name.Variable.Instance */
.catala-code .vm { color: #996633 } /* Name.Variable.Magic */
.catala-code .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */

</style>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
</head>
<h1>Legislative text implementation<br />
<small>Document generated by Catala version 0.4.0</small>
</h1>
<p>
Source files weaved in this document
</p>
<ul>
<li><tt>tutorial_en.catala_en</tt>, last modification 2021-05-15, 16:06</li>
</ul>
<h2 class='law-heading'><a href='#'>The Catala language tutorial</a></h2>
<p class='law-text'>Welcome to this tutorial, whose objective is to guide you through the features
of the Catala language and teach you how to annotate a legislative text using
the language. This document is addressed primarily to developers or people that
have a programming background, though tech-savvy lawyers will probably figure
things out.</p>
<h3 class='law-heading'><a href='#'>Literate programming</a></h3>
<p class='law-text'>To begin writing a Catala program, you must start from the text of the
legislative source that will justify the code that you will write. Concretely,
that means copy-pasting the text of the law into a Catala source file and
formatting it according so that Catala can understand it. Catala source files
have the ".catala_en" extension. If you were to write a Catala program for a
French law, you would use the ".catala_fr" extension.<br/>
You can write any kind of plain text in Catala, and it will be printed as is
in PDF or HTML output. You can split your text into short lines, those
will appear as a single paragraph in the output. If you want to create a
new paragrah, you have to leave a blank line in the source.<br/>
Catala allows you to declare section or subsection headers as it is done
here, with the "at" symbol repeated twice. You can define heading of lower
importance by adding increasing numbers of "+" after the title of the heading.<br/>
The fundamental division unit is the article, introduced by a single "at".
Let's analyse a fictional example that defines an income tax.</p>
<h4 class='law-heading'><a href='#'>Article 1</a></h4>
<p class='law-text'>The income tax for an individual is defined as a fixed percentage of the
individual's income over a year.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-35">35</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-36">36</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-37">37</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-38">38</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-39">39</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-40">40</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-35"></a>```catala<span class="c1"></span>
<a name="tutorial_en.catala_en-36"></a><span class="c1"># Welcome to the code mode of Catala. This is a comment, because the line is</span>
<a name="tutorial_en.catala_en-37"></a><span class="c1"># prefixed by #.</span>
<a name="tutorial_en.catala_en-38"></a><span class="c1"># We will soon learn what to write here in order to translate the meaning</span>
<a name="tutorial_en.catala_en-39"></a><span class="c1"># of the article into Catala code.</span>
<a name="tutorial_en.catala_en-40"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>To do that, we will intertwine short snippets of code between the sentences of
the legislative text. Each snippet of code should be as short as possible and
as close as possible to the actual sentence that justifies the code. This style
is called literate programming, a programming paradigm invented by the famous
computer scientist Donald Knuth in the 70s.</p>
<h3 class='law-heading'><a href='#'>Defining a fictional income tax</a></h3>
<p class='law-text'>The content of article 1 uses a lot of implicit context: there exists an
individual with an income, as well as an income tax that the individual has
to pay each year. Even if this implicit context is not verbatim in the law,
we have to explicit it for programming purposes. Concretely, we need a
"metadata" section that defines the shape and types of the data used
inside the law.<br/>
Let's start our metadata section by declaring the type information for the
individual:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-62">62</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-63">63</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-64">64</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-65">65</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-66">66</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-67">67</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-68">68</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-69">69</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-70">70</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-71">71</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-72">72</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-73">73</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-74">74</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-62"></a>```catala
<a name="tutorial_en.catala_en-63"></a><span class="kd">declaration</span> <span class="kd">structure</span> <span class="nc">Individual</span><span class="o">:</span><span class="c1"></span>
<a name="tutorial_en.catala_en-64"></a><span class="c1">  # The name of the structure &quot;Individual&quot;, must start with an</span>
<a name="tutorial_en.catala_en-65"></a><span class="c1">  # uppercase letter: this is the CamelCase convention.</span>
<a name="tutorial_en.catala_en-66"></a>  <span class="kd">data</span> <span class="nv">income</span> <span class="kd">content</span> <span class="kt">money</span><span class="c1"></span>
<a name="tutorial_en.catala_en-67"></a><span class="c1">  # In this line, &quot;income&quot; is the name of the structure field and</span>
<a name="tutorial_en.catala_en-68"></a><span class="c1">  # &quot;money&quot; is the type of what is stored in that field.</span>
<a name="tutorial_en.catala_en-69"></a><span class="c1">  # Available types include: integer, decimal, money, date, duration,</span>
<a name="tutorial_en.catala_en-70"></a><span class="c1">  # and any other structure or enumeration that you declare</span>
<a name="tutorial_en.catala_en-71"></a>  <span class="kd">data</span> <span class="nv">number_of_children</span> <span class="kd">content</span> <span class="kt">integer</span><span class="c1"></span>
<a name="tutorial_en.catala_en-72"></a><span class="c1">  # &quot;income&quot; and &quot;number_of_children&quot; start by a lowercase letter,</span>
<a name="tutorial_en.catala_en-73"></a><span class="c1">  # they follow the snake_case convention</span>
<a name="tutorial_en.catala_en-74"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This structure contains two data fields, "income" and "number_of_children". Structures are
useful to group together data that goes together. Usually, you
get one structure per concrete object on which the law applies (like the
individual). It is up to you to decide how to group the data together,
but you should aim to optimize code readability.<br/>
Sometimes, the law gives an enumeration of different situations. These
enumerations are modeled in Catala using an enumeration type, like:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-87">87</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-88">88</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-89">89</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-90">90</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-91">91</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-92">92</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-93">93</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-94">94</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-95">95</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-96">96</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-97">97</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-98">98</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-87"></a>```catala
<a name="tutorial_en.catala_en-88"></a><span class="kd">declaration</span> <span class="kd">enumeration</span> <span class="nc">TaxCredit</span><span class="o">:</span><span class="c1"></span>
<a name="tutorial_en.catala_en-89"></a><span class="c1"># The name &quot;TaxCredit&quot; is also written in CamelCase</span>
<a name="tutorial_en.catala_en-90"></a>— <span class="nc">NoTaxCredit</span><span class="c1"></span>
<a name="tutorial_en.catala_en-91"></a><span class="c1"># This line says that &quot;TaxCredit&quot; can be a &quot;NoTaxCredit&quot; situation</span>
<a name="tutorial_en.catala_en-92"></a>— <span class="nc">ChildrenTaxCredit</span> <span class="kd">content</span> <span class="kt">integer</span><span class="c1"></span>
<a name="tutorial_en.catala_en-93"></a><span class="c1"># This line says that alternatively, &quot;TaxCredit&quot; can be a</span>
<a name="tutorial_en.catala_en-94"></a><span class="c1"># &quot;ChildrenTaxCredit&quot; situation. This situation carries a content</span>
<a name="tutorial_en.catala_en-95"></a><span class="c1"># of type integer corresponding to the number of children concerned</span>
<a name="tutorial_en.catala_en-96"></a><span class="c1"># by the tax credit. This means that if you&#39;re in the &quot;ChildrenTaxCredit&quot;</span>
<a name="tutorial_en.catala_en-97"></a><span class="c1"># situation, you will also have access to this number of children</span>
<a name="tutorial_en.catala_en-98"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>In computer science terms, such an enumeration is called a "sum type" or simply
an enum. The combination of structures and enumerations allow the Catala
programmer to declare all possible shapes of data, as they are equivalent to
the powerful notion of "algebraic datatypes".<br/>
We've defined and typed the data that the program will manipulate. Now we have
to define the logical context in which these data will evolve. This is done in
Catala using "scopes". Scopes are close to functions in terms of traditional
programming. Scopes also have to be declared in metadata, so here we go:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-112">112</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-113">113</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-114">114</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-115">115</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-116">116</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-117">117</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-118">118</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-119">119</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-120">120</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-121">121</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-112"></a>```catala
<a name="tutorial_en.catala_en-113"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span><span class="c1"></span>
<a name="tutorial_en.catala_en-114"></a><span class="c1">  # Scope names use CamelCase</span>
<a name="tutorial_en.catala_en-115"></a>  <span class="kd">context</span> <span class="nv">individual</span> <span class="kd">content</span> <span class="nc">Individual</span><span class="c1"></span>
<a name="tutorial_en.catala_en-116"></a><span class="c1">  # This line declares a context element of the scope, which is akin to</span>
<a name="tutorial_en.catala_en-117"></a><span class="c1">  # a function parameter in computer science term. This is the piece of</span>
<a name="tutorial_en.catala_en-118"></a><span class="c1">  # data on which the scope will operate</span>
<a name="tutorial_en.catala_en-119"></a>  <span class="kd">context</span> <span class="nv">fixed_percentage</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a name="tutorial_en.catala_en-120"></a>  <span class="kd">context</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-121"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>We now have everything to annotate the contents of article 1, which is copied
over below.</p>
<h4 class='law-heading'><a href='#'>Article 1</a></h4>
<p class='law-text'>The income tax for an individual is defined as a fixed percentage of the
individual's income over a year.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-132">132</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-133">133</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-134">134</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-135">135</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-136">136</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-132"></a>```catala
<a name="tutorial_en.catala_en-133"></a><span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a name="tutorial_en.catala_en-134"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span>
<a name="tutorial_en.catala_en-135"></a>    <span class="nv">individual</span><span class="o">.</span>income ×<span class="o">$</span> <span class="nv">fixed_percentage</span>
<a name="tutorial_en.catala_en-136"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>In the code, we are defining inside our scope the amount of the income tax
according to the formula described in the article. When defining formulae,
you have access to all the usual arithmetic operators: addition "+",
substraction "-", multiplication "*" and division (slash).<br/>
However, in the Catala code, you can see that we use "*$" to multiply the
individual income by the fixed percentage. The $ suffix indicates that we
are performing a multiplication on an amount of money. Indeed, in Catala,
you have to keep track of what you are dealing with: is it money ? Is it
an integer? Using just "+" or "*" can be ambiguous in terms of rounding,
since money is usually rounded at the cent. So to disambiguate, we suffix these
operations with something that indicates the type of what we manipulate.
The suffixes are "$" for money "." for decimals, "at" (like in email adresses)
for dates and the hat symbol for durations. If you forget the suffix, the Catala type
checker will display an error message that will help you put it where it
belongs.<br/>
But inside article 1, one question remains unknown: what is the value of
of the fixed percentage? Often, precise values are defined elsewhere in the
legislative source. Here, let's suppose we have:</p>
<h4 class='law-heading'><a href='#'>Article 2</a></h4>
<p class='law-text'>The fixed percentage mentionned at article 1 is equal to 20 %.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-163">163</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-164">164</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-165">165</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-166">166</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-167">167</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-163"></a>```catala
<a name="tutorial_en.catala_en-164"></a><span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a name="tutorial_en.catala_en-165"></a>  <span class="kd">definition</span> <span class="nv">fixed_percentage</span> <span class="kd">equals</span> <span class="mi">20</span> <span class="o">%</span><span class="c1"></span>
<a name="tutorial_en.catala_en-166"></a><span class="c1">  # Writing 20% is just an abbreviation for 0.20</span>
<a name="tutorial_en.catala_en-167"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>You can see here that Catala allows definitions to be scattered throughout
the annotation of the legislative text, so that each
definition is as close as possible to its location in the text.</p>
<h3 class='law-heading'><a href='#'>Conditional definitions</a></h3>
<p class='law-text'>So far so good, but now the legislative text introduces some trickiness. Let us
suppose the third article says:</p>
<h4 class='law-heading'><a href='#'>Article 3</a></h4>
<p class='law-text'>If the individual is in charge of 2 or more children, then the fixed
percentage mentionned at article 1 is equal to 15 %.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-182">182</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-183">183</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-184">184</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-182"></a>```catala<span class="c1"></span>
<a name="tutorial_en.catala_en-183"></a><span class="c1"># How to redefine fixed_percentage?</span>
<a name="tutorial_en.catala_en-184"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This article actually gives another definition for the fixed percentage, which
was already defined in article 2. However, article 3 defines the percentage
conditionnally to the individual having more than 2 children. Catala allows
you precisely to redefine a variable under a condition:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-192">192</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-193">193</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-194">194</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-195">195</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-196">196</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-197">197</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-198">198</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-192"></a>```catala
<a name="tutorial_en.catala_en-193"></a><span class="kd">scope</span> <span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a name="tutorial_en.catala_en-194"></a>  <span class="kd">definition</span> <span class="nv">fixed_percentage</span> <span class="kd">under condition</span>
<a name="tutorial_en.catala_en-195"></a>    <span class="nv">individual</span><span class="o">.</span>number_of_children ≥ <span class="mi">2</span>
<a name="tutorial_en.catala_en-196"></a>  <span class="kd">consequence</span> <span class="kd">equals</span> <span class="mi">15</span> <span class="o">%</span><span class="c1"></span>
<a name="tutorial_en.catala_en-197"></a><span class="c1">  # Writing 15% is just an abbreviation for 0.15</span>
<a name="tutorial_en.catala_en-198"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>When the Catala program will execute, the right definition will be dynamically
chosen by looking at which condition is true. A correctly drafted legislative
source should always ensure that at most one condition is true at all times.
However, if it is not the case, Catala will let you define a precedence on the
conditions, which has to be justified by the law.</p>
<h3 class='law-heading'><a href='#'>Functions</a></h3>
<p class='law-text'>Catala lets you define functions anywhere in your data. Here's what it looks
like in the metadata definition when we want to define a two-brackets tax
computation:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-213">213</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-214">214</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-215">215</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-216">216</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-217">217</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-218">218</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-219">219</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-220">220</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-221">221</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-222">222</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-213"></a>```catala
<a name="tutorial_en.catala_en-214"></a><span class="kd">declaration</span> <span class="kd">structure</span> <span class="nc">TwoBrackets</span><span class="o">:</span>
<a name="tutorial_en.catala_en-215"></a>  <span class="kd">data</span> <span class="nv">breakpoint</span> <span class="kd">content</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-216"></a>  <span class="kd">data</span> <span class="nv">rate1</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a name="tutorial_en.catala_en-217"></a>  <span class="kd">data</span> <span class="nv">rate2</span> <span class="kd">content</span> <span class="kt">decimal</span>
<a name="tutorial_en.catala_en-218"></a>
<a name="tutorial_en.catala_en-219"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span> <span class="o">:</span>
<a name="tutorial_en.catala_en-220"></a>  <span class="kd">context</span> <span class="nv">brackets</span> <span class="kd">content</span> <span class="nc">TwoBrackets</span>
<a name="tutorial_en.catala_en-221"></a>  <span class="kd">context</span> <span class="nv">tax_formula</span> <span class="kd">content</span> <span class="kt">money</span> <span class="kd">depends on</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-222"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>And in the code:</p>
<h4 class='law-heading'><a href='#'>Article4</a></h4>
<p class='law-text'>The tax amount for a two-brackets computation is equal to the amount
of income in each bracket multiplied by the rate of each bracket.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-232">232</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-233">233</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-234">234</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-235">235</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-236">236</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-237">237</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-238">238</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-239">239</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-240">240</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-241">241</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-232"></a>```catala
<a name="tutorial_en.catala_en-233"></a><span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span> <span class="o">:</span>
<a name="tutorial_en.catala_en-234"></a>  <span class="kd">definition</span> <span class="nv">tax_formula</span> <span class="kr">of</span> <span class="nv">income</span> <span class="kd">equals</span>
<a name="tutorial_en.catala_en-235"></a>    <span class="kr">if</span> <span class="nv">income</span> ≤<span class="o">$</span> <span class="nv">brackets</span><span class="o">.</span>breakpoint <span class="kr">then</span>
<a name="tutorial_en.catala_en-236"></a>      <span class="nv">income</span> ×<span class="o">$</span> <span class="nv">brackets</span><span class="o">.</span>rate1
<a name="tutorial_en.catala_en-237"></a>    <span class="kr">else</span> <span class="o">(</span>
<a name="tutorial_en.catala_en-238"></a>      <span class="nv">brackets</span><span class="o">.</span>breakpoint ×<span class="o">$</span> <span class="nv">brackets</span><span class="o">.</span>rate1 <span class="o">+$</span>
<a name="tutorial_en.catala_en-239"></a>      <span class="o">(</span><span class="nv">income</span> <span class="o">-$</span> <span class="nv">brackets</span><span class="o">.</span>breakpoint<span class="o">)</span> ×<span class="o">$</span> <span class="nv">brackets</span><span class="o">.</span>rate2
<a name="tutorial_en.catala_en-240"></a>    <span class="o">)</span>
<a name="tutorial_en.catala_en-241"></a>```
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Scope inclusion</a></h3>
<p class='law-text'>Now that we've defined our helper scope for computing a two-brackets tax, we
want to use it in our main tax computation scope.</p>
<h4 class='law-heading'><a href='#'>Article 5</a></h4>
<p class='law-text'>For individuals whose income is greater than $100,000, the income
tax of article 1 is 40% of the income above $100,000. Below $100,000, the
income tax is 20% of the income.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-254">254</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-255">255</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-256">256</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-257">257</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-258">258</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-259">259</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-260">260</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-261">261</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-262">262</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-263">263</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-264">264</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-265">265</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-266">266</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-267">267</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-268">268</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-269">269</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-270">270</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-254"></a>```catala
<a name="tutorial_en.catala_en-255"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span><span class="o">:</span>
<a name="tutorial_en.catala_en-256"></a>  <span class="kd">context</span> <span class="nv">two_brackets</span> <span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span><span class="c1"></span>
<a name="tutorial_en.catala_en-257"></a><span class="c1">  # This line says that we add the item two_brackets to the context.</span>
<a name="tutorial_en.catala_en-258"></a><span class="c1">  # However, the &quot;scope&quot; keyword tells that this item is not a piece of data</span>
<a name="tutorial_en.catala_en-259"></a><span class="c1">  # but rather a subscope that we can use to compute things.</span>
<a name="tutorial_en.catala_en-260"></a>  <span class="kd">context</span> <span class="nv">individual</span> <span class="kd">content</span> <span class="nc">Individual</span>
<a name="tutorial_en.catala_en-261"></a>  <span class="kd">context</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-262"></a>
<a name="tutorial_en.catala_en-263"></a><span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span> <span class="o">:</span>
<a name="tutorial_en.catala_en-264"></a>  <span class="kd">definition</span> <span class="nv">two_brackets</span><span class="o">.</span>brackets <span class="kd">equals</span> <span class="nc">TwoBrackets</span> <span class="o">{</span>
<a name="tutorial_en.catala_en-265"></a>    — <span class="nv">breakpoint</span><span class="o">:</span> <span class="o">$</span><span class="mi">100,000</span>
<a name="tutorial_en.catala_en-266"></a>    — <span class="nv">rate1</span><span class="o">:</span> <span class="mi">20</span><span class="o">%</span>
<a name="tutorial_en.catala_en-267"></a>    — <span class="nv">rate2</span><span class="o">:</span> <span class="mi">40</span><span class="o">%</span>
<a name="tutorial_en.catala_en-268"></a>  <span class="o">}</span>
<a name="tutorial_en.catala_en-269"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">two_brackets</span><span class="o">.</span>tax_formula <span class="kr">of</span> <span class="nv">individual</span><span class="o">.</span>income
<a name="tutorial_en.catala_en-270"></a>```
</pre></div>
</td></tr></table>
</div>

<h4 class='law-heading'><a href='#'>Article 6</a></h4>
<p class='law-text'>Individuals earning less than $10,000 are exempted of the income tax mentionned
at article 1.</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-277">277</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-278">278</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-279">279</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-280">280</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-281">281</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-282">282</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-277"></a>```catala
<a name="tutorial_en.catala_en-278"></a><span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span><span class="o">:</span>
<a name="tutorial_en.catala_en-279"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">under condition</span>
<a name="tutorial_en.catala_en-280"></a>    <span class="nv">individual</span><span class="o">.</span>income ≤<span class="o">$</span> <span class="o">$</span><span class="mi">10,000</span>
<a name="tutorial_en.catala_en-281"></a>  <span class="kd">consequence</span> <span class="kd">equals</span> <span class="o">$</span><span class="mi">0</span>
<a name="tutorial_en.catala_en-282"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>That's it! We've defined a two-brackets tax computation simply by annotating
legislative article by snippets of Catala code. However, attentive readers
may have caught something weird in articles 5 and 6. What happens when the
income of the individual is between $10,000 and $100,000 ?<br/>
The law leaves it unspecified ; our dummy articles are clearly badly drafted.
But Catala can help you find this sort of errors via simple testing or
even formal verification. Let's start with the testing.</p>
<h3 class='law-heading'><a href='#'>Testing Catala programs</a></h3>
<p class='law-text'>Testing Catala programs can be done directly into Catala. Indeed, writing test
cases for each Catala scope that you define is a good practice called
"unit testing" in the software engineering community. A test case is defined
as another scope:</p>
<h4 class='law-heading'><a href='#'>Testing NewIncomeTaxComputation</a></h4>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-302">302</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-303">303</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-304">304</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-305">305</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-306">306</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-307">307</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-308">308</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-309">309</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-310">310</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-311">311</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-312">312</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-313">313</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-314">314</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-315">315</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-316">316</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-317">317</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-318">318</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-319">319</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-320">320</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-321">321</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-322">322</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-323">323</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-324">324</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-302"></a>```catala
<a name="tutorial_en.catala_en-303"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">Test1</span><span class="o">:</span>
<a name="tutorial_en.catala_en-304"></a>  <span class="kd">context</span> <span class="nv">tax_computation</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span>
<a name="tutorial_en.catala_en-305"></a>  <span class="kd">context</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-306"></a>
<a name="tutorial_en.catala_en-307"></a><span class="kd">scope</span> <span class="nc">Test1</span><span class="o">:</span>
<a name="tutorial_en.catala_en-308"></a>  <span class="kd">definition</span>
<a name="tutorial_en.catala_en-309"></a>    <span class="nv">tax_computation</span><span class="o">.</span>individual<span class="c1"></span>
<a name="tutorial_en.catala_en-310"></a><span class="c1">    # We define the argument to the subscope</span>
<a name="tutorial_en.catala_en-311"></a>  <span class="kd">equals</span><span class="c1"></span>
<a name="tutorial_en.catala_en-312"></a><span class="c1">    # The four lines below define a whole structure by giving a value to</span>
<a name="tutorial_en.catala_en-313"></a><span class="c1">    # each of its fields</span>
<a name="tutorial_en.catala_en-314"></a>    <span class="nc">Individual</span> <span class="o">{</span>
<a name="tutorial_en.catala_en-315"></a>      — <span class="nv">income</span><span class="o">:</span> <span class="o">$</span><span class="mi">230,000</span>
<a name="tutorial_en.catala_en-316"></a>      — <span class="nv">number_of_children</span><span class="o">:</span> <span class="mi">0</span>
<a name="tutorial_en.catala_en-317"></a>    <span class="o">}</span>
<a name="tutorial_en.catala_en-318"></a>
<a name="tutorial_en.catala_en-319"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax<span class="c1"></span>
<a name="tutorial_en.catala_en-320"></a><span class="c1">  # Next, we retrieve the income tax value compute it by the subscope and</span>
<a name="tutorial_en.catala_en-321"></a><span class="c1">  # assert that it is equal to the expected value :</span>
<a name="tutorial_en.catala_en-322"></a><span class="c1">  # ($230,000-$100,00)×40%+$100,000×20% = $72,000</span>
<a name="tutorial_en.catala_en-323"></a>  <span class="kd">assertion</span> <span class="nv">income_tax</span> <span class="o">=</span> <span class="o">$</span><span class="mi">72,000</span>
<a name="tutorial_en.catala_en-324"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This test should pass. Let us now consider a failing test case:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-328">328</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-329">329</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-330">330</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-331">331</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-332">332</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-333">333</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-334">334</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-335">335</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-336">336</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-337">337</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-338">338</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-339">339</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-340">340</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-341">341</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-328"></a>```catala
<a name="tutorial_en.catala_en-329"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">Test2</span><span class="o">:</span>
<a name="tutorial_en.catala_en-330"></a>  <span class="kd">context</span> <span class="nv">tax_computation</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputation</span>
<a name="tutorial_en.catala_en-331"></a>  <span class="kd">context</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-332"></a>
<a name="tutorial_en.catala_en-333"></a><span class="kd">scope</span> <span class="nc">Test2</span><span class="o">:</span>
<a name="tutorial_en.catala_en-334"></a>  <span class="kd">definition</span> <span class="nv">tax_computation</span><span class="o">.</span>individual <span class="kd">equals</span> <span class="nc">Individual</span> <span class="o">{</span>
<a name="tutorial_en.catala_en-335"></a>    — <span class="nv">income</span><span class="o">:</span> <span class="o">$</span><span class="mi">4,000</span>
<a name="tutorial_en.catala_en-336"></a>    — <span class="nv">number_of_children</span><span class="o">:</span> <span class="mi">0</span>
<a name="tutorial_en.catala_en-337"></a>  <span class="o">}</span>
<a name="tutorial_en.catala_en-338"></a>
<a name="tutorial_en.catala_en-339"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax
<a name="tutorial_en.catala_en-340"></a>  <span class="kd">assertion</span> <span class="nv">income_tax</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0</span>
<a name="tutorial_en.catala_en-341"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>This test case should compute a $0 income tax because of Article 6. But instead,
execution will yield an error saying that there is a conflict between rules.</p>
<h3 class='law-heading'><a href='#'>Defining exceptions to rules</a></h3>
<p class='law-text'>Indeed, the definition of the income tax in article 6 conflicts with the
definition of income tax in article 5. But actually, article 6 is just an
exception of article 5. In the law, it is implicit that if article 6 is
applicable, then it takes precedence over article 5.</p>
<h4 class='law-heading'><a href='#'>Fixing the computation</a></h4>
<p class='law-text'>This implicit precedence has to be explicitely declared in Catala. Here is a
fixed version of the NewIncomeTaxComputation scope:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-358">358</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-359">359</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-360">360</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-361">361</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-362">362</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-363">363</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-364">364</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-365">365</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-366">366</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-367">367</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-368">368</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-369">369</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-370">370</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-371">371</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-372">372</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-373">373</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-374">374</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-375">375</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-376">376</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-377">377</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-378">378</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-379">379</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-380">380</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-381">381</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-382">382</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-358"></a>```catala
<a name="tutorial_en.catala_en-359"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span><span class="o">:</span>
<a name="tutorial_en.catala_en-360"></a>  <span class="kd">context</span> <span class="nv">two_brackets</span> <span class="kd">scope</span> <span class="nc">TwoBracketsTaxComputation</span>
<a name="tutorial_en.catala_en-361"></a>  <span class="kd">context</span> <span class="nv">individual</span> <span class="kd">content</span> <span class="nc">Individual</span>
<a name="tutorial_en.catala_en-362"></a>  <span class="kd">context</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-363"></a>
<a name="tutorial_en.catala_en-364"></a><span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span> <span class="o">:</span>
<a name="tutorial_en.catala_en-365"></a>  <span class="kd">definition</span> <span class="nv">two_brackets</span><span class="o">.</span>brackets <span class="kd">equals</span> <span class="nc">TwoBrackets</span> <span class="o">{</span>
<a name="tutorial_en.catala_en-366"></a>    — <span class="nv">breakpoint</span><span class="o">:</span> <span class="o">$</span><span class="mi">100,000</span>
<a name="tutorial_en.catala_en-367"></a>    — <span class="nv">rate1</span><span class="o">:</span> <span class="mi">20</span><span class="o">%</span>
<a name="tutorial_en.catala_en-368"></a>    — <span class="nv">rate2</span><span class="o">:</span> <span class="mi">40</span><span class="o">%</span>
<a name="tutorial_en.catala_en-369"></a>  <span class="o">}</span><span class="c1"></span>
<a name="tutorial_en.catala_en-370"></a>
<a name="tutorial_en.catala_en-371"></a><span class="c1">  # To define an exception to a rule, you have to first label the rule that</span>
<a name="tutorial_en.catala_en-372"></a><span class="c1">  # you want to attach the exception to. You can put any snake_case identifier</span>
<a name="tutorial_en.catala_en-373"></a><span class="c1">  # for the label</span>
<a name="tutorial_en.catala_en-374"></a>  <span class="kd">label</span> <span class="nv">article_5</span>
<a name="tutorial_en.catala_en-375"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">two_brackets</span><span class="o">.</span>tax_formula <span class="kr">of</span> <span class="nv">individual</span><span class="o">.</span>income<span class="c1"></span>
<a name="tutorial_en.catala_en-376"></a>
<a name="tutorial_en.catala_en-377"></a><span class="c1">  # Then, you can declare the exception by referring back to the label</span>
<a name="tutorial_en.catala_en-378"></a>  <span class="kd">exception</span> <span class="nv">article_5</span>
<a name="tutorial_en.catala_en-379"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">under condition</span>
<a name="tutorial_en.catala_en-380"></a>    <span class="nv">individual</span><span class="o">.</span>income ≤<span class="o">$</span> <span class="o">$</span><span class="mi">10,000</span>
<a name="tutorial_en.catala_en-381"></a>  <span class="kd">consequence</span> <span class="kd">equals</span> <span class="o">$</span><span class="mi">0</span>
<a name="tutorial_en.catala_en-382"></a>```
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>And the test that should now work:</p>
<div class='code-wrapper'>
<div class='filename'>tutorial_en.catala_en</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#tutorial_en.catala_en-386">386</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-387">387</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-388">388</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-389">389</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-390">390</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-391">391</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-392">392</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-393">393</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-394">394</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-395">395</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-396">396</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-397">397</a></span>
<span class="normal"><a href="#tutorial_en.catala_en-398">398</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="tutorial_en.catala_en-386"></a>```catala
<a name="tutorial_en.catala_en-387"></a><span class="kd">declaration</span> <span class="kd">scope</span> <span class="nc">Test3</span><span class="o">:</span>
<a name="tutorial_en.catala_en-388"></a>  <span class="kd">context</span> <span class="nv">tax_computation</span> <span class="kd">scope</span> <span class="nc">NewIncomeTaxComputationFixed</span>
<a name="tutorial_en.catala_en-389"></a>  <span class="kd">context</span> <span class="nv">income_tax</span> <span class="kd">content</span> <span class="kt">money</span>
<a name="tutorial_en.catala_en-390"></a>
<a name="tutorial_en.catala_en-391"></a><span class="kd">scope</span> <span class="nc">Test3</span><span class="o">:</span>
<a name="tutorial_en.catala_en-392"></a>  <span class="kd">definition</span> <span class="nv">tax_computation</span><span class="o">.</span>individual <span class="kd">equals</span> <span class="nc">Individual</span> <span class="o">{</span>
<a name="tutorial_en.catala_en-393"></a>    — <span class="nv">income</span><span class="o">:</span> <span class="o">$</span><span class="mi">4,000</span>
<a name="tutorial_en.catala_en-394"></a>    — <span class="nv">number_of_children</span><span class="o">:</span> <span class="mi">0</span>
<a name="tutorial_en.catala_en-395"></a>  <span class="o">}</span>
<a name="tutorial_en.catala_en-396"></a>  <span class="kd">definition</span> <span class="nv">income_tax</span> <span class="kd">equals</span> <span class="nv">tax_computation</span><span class="o">.</span>income_tax
<a name="tutorial_en.catala_en-397"></a>  <span class="kd">assertion</span> <span class="nv">income_tax</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0</span>
<a name="tutorial_en.catala_en-398"></a>```
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Conclusion</a></h3>
<p class='law-text'>This tutorial presents the basic concepts and syntax of the Catala language
features. It is then up to you use them to annotate legislative texts
with their algorithmic translation.<br/>
There is no single way to write Catala programs, as the program style should be
adapted to the legislation it annotates. However, Catala is a functional
language at heart, so following standard functional programming design patterns
should help achieve concise and readable code.</p>