<head>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.catala-code .hll { background-color: #ffffcc }
.catala-code { background: #ffffff; }
.catala-code .c { color: #888888 } /* Comment */
.catala-code .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.catala-code .k { color: #008800; font-weight: bold } /* Keyword */
.catala-code .o { color: #333333 } /* Operator */
.catala-code .ch { color: #888888 } /* Comment.Hashbang */
.catala-code .cm { color: #888888 } /* Comment.Multiline */
.catala-code .cp { color: #557799 } /* Comment.Preproc */
.catala-code .cpf { color: #888888 } /* Comment.PreprocFile */
.catala-code .c1 { color: #888888 } /* Comment.Single */
.catala-code .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.catala-code .gd { color: #A00000 } /* Generic.Deleted */
.catala-code .ge { font-style: italic } /* Generic.Emph */
.catala-code .gr { color: #FF0000 } /* Generic.Error */
.catala-code .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.catala-code .gi { color: #00A000 } /* Generic.Inserted */
.catala-code .go { color: #888888 } /* Generic.Output */
.catala-code .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.catala-code .gs { font-weight: bold } /* Generic.Strong */
.catala-code .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.catala-code .gt { color: #0044DD } /* Generic.Traceback */
.catala-code .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.catala-code .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.catala-code .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.catala-code .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.catala-code .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.catala-code .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.catala-code .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.catala-code .s { background-color: #fff0f0 } /* Literal.String */
.catala-code .na { color: #0000CC } /* Name.Attribute */
.catala-code .nb { color: #007020 } /* Name.Builtin */
.catala-code .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.catala-code .no { color: #003366; font-weight: bold } /* Name.Constant */
.catala-code .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.catala-code .ni { color: #880000; font-weight: bold } /* Name.Entity */
.catala-code .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.catala-code .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.catala-code .nl { color: #997700; font-weight: bold } /* Name.Label */
.catala-code .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.catala-code .nt { color: #007700 } /* Name.Tag */
.catala-code .nv { color: #996633 } /* Name.Variable */
.catala-code .ow { color: #000000; font-weight: bold } /* Operator.Word */
.catala-code .w { color: #bbbbbb } /* Text.Whitespace */
.catala-code .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.catala-code .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.catala-code .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.catala-code .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.catala-code .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.catala-code .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.catala-code .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.catala-code .sc { color: #0044DD } /* Literal.String.Char */
.catala-code .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.catala-code .sd { color: #DD4422 } /* Literal.String.Doc */
.catala-code .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.catala-code .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.catala-code .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.catala-code .si { background-color: #eeeeee } /* Literal.String.Interpol */
.catala-code .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.catala-code .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.catala-code .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.catala-code .ss { color: #AA6600 } /* Literal.String.Symbol */
.catala-code .bp { color: #007020 } /* Name.Builtin.Pseudo */
.catala-code .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.catala-code .vc { color: #336699 } /* Name.Variable.Class */
.catala-code .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.catala-code .vi { color: #3333BB } /* Name.Variable.Instance */
.catala-code .vm { color: #996633 } /* Name.Variable.Magic */
.catala-code .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */

</style>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
</head>
<h1>Implémentation de texte législatif<br />
<small>Document généré par Catala version 0.5.0</small>
</h1>
<p>
Fichiers sources tissés dans ce document
</p>
<ul>
<li><tt>tutoriel_fr.catala_fr</tt>, dernière modification le 2021-10-11, 17:40</li>
</ul>
<h2 class='law-heading'><a href='#'>Tutoriel d'utilisation du langage Catala</a></h2>
<p class='law-text'>Bienvenue dans ce tutoriel, son objectif est de vous accompagner dans les
fonctionnalités du langage Catala et de vous apprendre à annoter des textes
législatifs avec ce langage. Ce document s'adresse principalement à des développeurs
ou des personnes ayant déjà programmé, même si des juristes avec des appétences
en informatique devraient pouvoir s'en sortir.</p>
<h3 class='law-heading'><a href='#'>Programmation littéraire</a></h3>
<p class='law-text'>Pour commencer à écrire un programme Catala, vous devez partir du texte
d'une source législative qui va justifier le code que vous écrirez.
Concrètement, cela signifie faire un copier-coller du texte de la loi dans
un fichier de source Catala et le formater afin que Catala puisse le comprendre.
Les fichiers de source Catala ont l'extension ".catala_en" en version anglaise.
Si vous écriviez un programme Catala pour une loi française, vous devrez utiliser
l'extension ".catala_fr".<br/>
Vous pouvez écrire n'importe quel texte simple en Catala, cela sera affiché
sans modification dans une sortie PDF ou HTML. Vous pouvez découper votre texte
en de courtes lignes, cela apparaîtra comme un seul paragraphe dans la sortie.
Si vous voulez créer un nouveau paragraphe laisser une ligne vierge dans la source.<br/>
Catala vous permet de déclarer des entêtes de section ou de sous-section,
en les précédant et les suivant de deux signes dièze "#". Vous pouvez
diminuer l'importance du titre en augmentant le nombre de "#" après le titre de
l'entête.
Étudions un exemple fictif qui définit un impôt sur le revenu.</p>
<h4 class='law-heading'><a href='#'>Article 1</a></h4>
<p class='law-text'>L'impôt sur le revenu d'un individu est calculé en tant qu'un pourcentage
fixe des revenus d'une personne pour une année.</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-37">37</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-38">38</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-39">39</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-40">40</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-37" name="tutoriel_fr.catala_fr-37"></a><span class="c1"># Bienvenue dans le mode code de Catala.</span>
<a id="tutoriel_fr.catala_fr-38" name="tutoriel_fr.catala_fr-38"></a><span class="c1"># Ceci est un commentaire car la ligne débute par le caractère #.</span>
<a id="tutoriel_fr.catala_fr-39" name="tutoriel_fr.catala_fr-39"></a><span class="c1"># Nous allons bientôt apprendre ce que l&#39;on doit écrire ici pour traduire</span>
<a id="tutoriel_fr.catala_fr-40" name="tutoriel_fr.catala_fr-40"></a><span class="c1"># le sens d&#39;un article de loi en code Catala.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Afin de faire cela, nous allons entremêler courts bouts de code et phrases
du texte législatif. Chaque bout de code devra être aussi court que possible
et aussi proche que possible de la phrase qui justifie le code. Ce style
s'appelle programmation littéraire, un paradigme de programmation inventé par le
célèbre informaticien Donald Knuth dans les années 70.</p>
<h3 class='law-heading'><a href='#'>Définir un impôt sur le revenu fictif</a></h3>
<p class='law-text'>Le contenu de l'article 1 utilise beaucoup d'éléments du contexte implicite :
il existe une personne avec un revenu et en même temps un impôt sur le revenu,
qu'une personne doit acquitter chaque année. Même si ce contexte implicite n'est
pas inscrit en tant que tel dans la loi, nous devons l'expliciter pour le traduire
en code. Concrètement, nous avons besoin d'une section "métadonnées" qui définit
la forme et les types de données contenues dans la loi.<br/>
Commençons notre section métadonnées en déclarant l'information sur le type
personne :</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-62">62</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-63">63</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-64">64</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-65">65</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-66">66</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-67">67</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-68">68</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-69">69</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-70">70</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-71">71</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-72">72</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-73">73</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-62" name="tutoriel_fr.catala_fr-62"></a><span class="kd">déclaration</span> <span class="kd">structure</span> <span class="nc">Personne</span><span class="o">:</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-63" name="tutoriel_fr.catala_fr-63"></a><span class="c1">  # Le nom de la structure &quot;Personne&quot;, doit commencer</span>
<a id="tutoriel_fr.catala_fr-64" name="tutoriel_fr.catala_fr-64"></a><span class="c1">  # par une lettre majuscule: c&#39;est la convention CamelCase.</span>
<a id="tutoriel_fr.catala_fr-65" name="tutoriel_fr.catala_fr-65"></a>  <span class="kd">donnée</span> <span class="nv">revenu</span> <span class="kd">contenu</span> <span class="kt">argent</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-66" name="tutoriel_fr.catala_fr-66"></a><span class="c1">  # A cette ligne, revenu est le nom du champ de la structure et</span>
<a id="tutoriel_fr.catala_fr-67" name="tutoriel_fr.catala_fr-67"></a><span class="c1">  # &quot;argent&quot; est le type de de données de ce champ.</span>
<a id="tutoriel_fr.catala_fr-68" name="tutoriel_fr.catala_fr-68"></a><span class="c1">  # On peut utiliser d&#39;autres types comme : entier, décimal,</span>
<a id="tutoriel_fr.catala_fr-69" name="tutoriel_fr.catala_fr-69"></a><span class="c1">  # argent, date, durée ou tout autre structure ou énumération</span>
<a id="tutoriel_fr.catala_fr-70" name="tutoriel_fr.catala_fr-70"></a><span class="c1">  # que vous aurez déclaré</span>
<a id="tutoriel_fr.catala_fr-71" name="tutoriel_fr.catala_fr-71"></a>  <span class="kd">donnée</span> <span class="nv">nombre_enfants</span> <span class="kd">contenu</span> <span class="kt">entier</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-72" name="tutoriel_fr.catala_fr-72"></a><span class="c1">  # &quot;revenu&quot; and &quot;nombre_enfants&quot; commençent par une lettre minuscule,</span>
<a id="tutoriel_fr.catala_fr-73" name="tutoriel_fr.catala_fr-73"></a><span class="c1">  # ils adhèrent à la convention snake_case</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Cette structure contient deux champs de de données, "revenu" et "nombre_enfants".
Les structures sont utiles pour regrouper des données qui vont ensemble.
Typiquement, vous aurez une structure pour une entité concrète sur laquelle
s'applique la loi (comme une personne). C'est à vous de décider comment regrouper
les données mais vous devrez viser à optimiser la lisibilité du code.<br/>
Parfois, la loi donne une énumération de différentes situations. Ces énumérations
sont modélisés en Catala par le type énumération, comme suit :</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-86">86</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-87">87</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-88">88</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-89">89</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-90">90</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-91">91</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-92">92</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-93">93</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-94">94</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-95">95</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-96">96</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-86" name="tutoriel_fr.catala_fr-86"></a><span class="kd">déclaration</span> <span class="kd">énumération</span> <span class="nc">CréditImpôt</span><span class="o">:</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-87" name="tutoriel_fr.catala_fr-87"></a><span class="c1"># Le nom &quot;CréditImpôt&quot; s&#39;écrit aussi en CamelCase</span>
<a id="tutoriel_fr.catala_fr-88" name="tutoriel_fr.catala_fr-88"></a><span class="o">--</span> <span class="nc">AucunCréditImpôt</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-89" name="tutoriel_fr.catala_fr-89"></a><span class="c1"># Cette ligne indique que &quot;CréditImpôt&quot; peut être en situation</span>
<a id="tutoriel_fr.catala_fr-90" name="tutoriel_fr.catala_fr-90"></a><span class="c1"># &quot;AucunCréditImpôt&quot;</span>
<a id="tutoriel_fr.catala_fr-91" name="tutoriel_fr.catala_fr-91"></a><span class="o">--</span> <span class="nc">CréditImpôtEnfants</span> <span class="kd">contenu</span> <span class="kt">entier</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-92" name="tutoriel_fr.catala_fr-92"></a><span class="c1"># Cette ligne indique, de manière alternative, que &quot;CréditImpôt&quot; peut aussi</span>
<a id="tutoriel_fr.catala_fr-93" name="tutoriel_fr.catala_fr-93"></a><span class="c1"># être une situation &quot;CréditImpôtEnfants&quot;. Cette situation porte un contenu</span>
<a id="tutoriel_fr.catala_fr-94" name="tutoriel_fr.catala_fr-94"></a><span class="c1"># de type entier qui correspond au nombre d&#39;enfants concernés par le crédit</span>
<a id="tutoriel_fr.catala_fr-95" name="tutoriel_fr.catala_fr-95"></a><span class="c1"># d&#39;impôt. Cela signifie que si vous êtes dans la situation</span>
<a id="tutoriel_fr.catala_fr-96" name="tutoriel_fr.catala_fr-96"></a><span class="c1"># &quot;CréditImpôtEnfants&quot;, vous aurez aussi accès à ce nombre d&#39;enfants.</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>En informatique, une telle énumération est appelée "type somme" ou simplement
énumération. La combinaison de structures et d'énumération permet au programmeur
Catala de déclarer toutes les formes possibles de données, car cette combinaison
est équivalente à la puissante notion de types de données algébriques.<br/>
Nous avons défini et typé les données que le programme va manipuler. Maintenant,
nous devons définir un contexte logique dans lequel ces données vont évoluer.
On effectue cela par la notion de "champs d'application" en Catala.
Les champs d'application sont proches des fonctions en termes de programmation
traditionnelle. Les champs d'application doivent avoir été déclarés
préalablement dans les métadonnées, de la manière suivante:</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-112">112</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-113">113</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-114">114</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-115">115</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-116">116</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-117">117</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-118">118</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-119">119</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-112" name="tutoriel_fr.catala_fr-112"></a><span class="kd">déclaration</span> <span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtRevenu</span><span class="o">:</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-113" name="tutoriel_fr.catala_fr-113"></a><span class="c1">  # Les champs d&#39;application utilisent le CamelCase</span>
<a id="tutoriel_fr.catala_fr-114" name="tutoriel_fr.catala_fr-114"></a>  <span class="kd">contexte</span> <span class="nv">personne</span> <span class="kd">contenu</span> <span class="nc">Personne</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-115" name="tutoriel_fr.catala_fr-115"></a><span class="c1">  # Cette ligne déclare un élémént de contexte du champ d&#39;application,</span>
<a id="tutoriel_fr.catala_fr-116" name="tutoriel_fr.catala_fr-116"></a><span class="c1">  # cela ressemble à un paramètre de fonction en informatique. C&#39;est la</span>
<a id="tutoriel_fr.catala_fr-117" name="tutoriel_fr.catala_fr-117"></a><span class="c1">  # donnée sur laquelle le champ d&#39;application va intervenir</span>
<a id="tutoriel_fr.catala_fr-118" name="tutoriel_fr.catala_fr-118"></a>  <span class="kd">contexte</span> <span class="nv">pourcentage_fixe</span> <span class="kd">contenu</span> <span class="kt">décimal</span>
<a id="tutoriel_fr.catala_fr-119" name="tutoriel_fr.catala_fr-119"></a>  <span class="kd">contexte</span> <span class="nv">impôt_revenu</span> <span class="kd">contenu</span> <span class="kt">argent</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Nous avons maintenant tout ce dont nous avons besoin pour annoter le contenu
de l'article 1 qui a été copié ci-dessous.</p>
<h4 class='law-heading'><a href='#'>Article 1</a></h4>
<p class='law-text'>L'impôt sur le revenu pour une personne est défini comme un pourcentage fixe
des revenus de la personne pour une année.</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-131">131</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-132">132</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-133">133</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-131" name="tutoriel_fr.catala_fr-131"></a><span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtRevenu</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-132" name="tutoriel_fr.catala_fr-132"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">égal à</span>
<a id="tutoriel_fr.catala_fr-133" name="tutoriel_fr.catala_fr-133"></a>    <span class="nv">personne</span><span class="o">.</span>revenu <span class="o">*€</span> <span class="nv">pourcentage_fixe</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Dans le code, nous définissons à l'intérieur de notre champ d'application
le montant d'impôt sur le revenu selon la formule décrit dans l'article.
Quand nous définissons des formules, vous avez accès à tous les opérateurs
arithmétiques habituels : addition "+", soustraction "-", multiplication "*"
et division (barre oblique).<br/>
Toutefois, dans le code Catala, vous pouvez voir que nous utilisons "*€"
pour multiplier les revenus d'une personne par le pourcentage fixe. Le
suffixe € inique que nous effectuons une multiplication sur une somme d'argent.
En effet, en Catala, vous devez rester conscient de la donnée manipulée :
est-ce de l'argent ? est-ce un entier ? Utiliser simple "+" ou "*" est ambigu
en termes d'arrondis car l'argent est habituellement arrondi au centime.
Ainsi, afin d'être clair, nous suffixons ces opérations avec quelque chose
qui indique le type de donnée manipulé. Les suffixes sont "€" pour de l'argent,
"." pour les décimales, arobase (comme dans les adresses mail) pour les dates et
le symbole chapeau pour les durées. Si vous oubliez le suffixe, le vérificateur
de types de Catala va afficher une message d'erreur afin de vous aider à le placer
comme il le faut.<br/>
Mais dans l'article 1, une question reste sans réponse: quelle est la valeur
de la pourcentage fixe? Souvent, des valeurs précises sont définis ailleurs
dans les sources législatives. Ici, supposons que nous avons:</p>
<h4 class='law-heading'><a href='#'>Article 2</a></h4>
<p class='law-text'>Le pourcentage fixe mentionné à l'article 1 est égal à 20%.</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-164">164</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-165">165</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-166">166</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-164" name="tutoriel_fr.catala_fr-164"></a><span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtRevenu</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-165" name="tutoriel_fr.catala_fr-165"></a>  <span class="kd">définition</span> <span class="nv">pourcentage_fixe</span> <span class="kd">égal à</span> <span class="mi">20</span><span class="o">%</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-166" name="tutoriel_fr.catala_fr-166"></a><span class="c1">  # Ecrire 20% est juste une abbréviation pour 0.20</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Vous pouvez voir ici que Catala permet des définitions réparties dans toute
l'annotation du texte législatif, afin que chaque définition soit le plus
proche possible de sa localisation dans le texte.</p>
<h3 class='law-heading'><a href='#'>Définitions conditionnelles</a></h3>
<p class='law-text'>Jusqu'à là tout va bien mais maintenant le texte législatif présente quelques
difficultés. Supposons que le troisième article dispose :</p>
<h4 class='law-heading'><a href='#'>Article 3</a></h4>
<p class='law-text'>Si l'individu a à sa charge deux ou plus enfants alors
le pourcentage fixe mentionné à l'article 1 vaut 15 %.</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-184">184</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-184" name="tutoriel_fr.catala_fr-184"></a><span class="c1"># Comment redéfinir pourcentage_fixe ?</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Cet article donne en réalité une autre définition pour le pourcentage fixe,
préalablement défini à l'article 2. Toutefois, si l'article 3 définit le pourcentage
de manière conditionnelle pour la personne ayant plus de deux enfants.
Catala permet de redéfinir précisément une variable sous une condition :</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-193">193</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-194">194</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-195">195</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-196">196</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-197">197</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-193" name="tutoriel_fr.catala_fr-193"></a><span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtRevenu</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-194" name="tutoriel_fr.catala_fr-194"></a>  <span class="kd">définition</span> <span class="nv">pourcentage_fixe</span> <span class="kd">sous condition</span>
<a id="tutoriel_fr.catala_fr-195" name="tutoriel_fr.catala_fr-195"></a>    <span class="nv">personne</span><span class="o">.</span>nombre_enfants <span class="o">&gt;=</span> <span class="mi">2</span>
<a id="tutoriel_fr.catala_fr-196" name="tutoriel_fr.catala_fr-196"></a>  <span class="kd">conséquence</span> <span class="kd">égal à</span> <span class="mi">15</span><span class="o">%</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-197" name="tutoriel_fr.catala_fr-197"></a><span class="c1">  # Ecrire 15% est juste une abbréviation pour 0.15</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Quand le programme Catala va s'exécuter, la juste définition sera choisie
dynamiquement en déterminant laquelle des condition est vraie dans le contexte.
Une source législative rédigée correctement doit toujours garantir qu'au maximum
une seule condition soit vraie à tout moment. Toutefois, si ce n'est pas le cas,
Catala vous permettra de définir un ordre des priorités sur les conditions,
qui doit être justifié par un raisonnement juridique.</p>
<h3 class='law-heading'><a href='#'>Fonctions</a></h3>
<p class='law-text'>Catala vous permet de définir des fonctions partout dans vos données. Voici
à quoi cela ressemble dans la définition des métadonnées quand nous voulons
définir un calcul de l'impôt sur le revenu à deux tranches :</p>
<div class='code-wrapper code-metadata'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-214">214</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-215">215</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-216">216</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-217">217</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-218">218</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-219">219</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-220">220</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-221">221</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-214" name="tutoriel_fr.catala_fr-214"></a><span class="kd">déclaration</span> <span class="kd">structure</span> <span class="nc">DeuxTranches</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-215" name="tutoriel_fr.catala_fr-215"></a>  <span class="kd">donnée</span> <span class="nv">seuil</span> <span class="kd">contenu</span> <span class="kt">argent</span>
<a id="tutoriel_fr.catala_fr-216" name="tutoriel_fr.catala_fr-216"></a>  <span class="kd">donnée</span> <span class="nv">taux1</span> <span class="kd">contenu</span> <span class="kt">décimal</span>
<a id="tutoriel_fr.catala_fr-217" name="tutoriel_fr.catala_fr-217"></a>  <span class="kd">donnée</span> <span class="nv">taux2</span> <span class="kd">contenu</span> <span class="kt">décimal</span>
<a id="tutoriel_fr.catala_fr-218" name="tutoriel_fr.catala_fr-218"></a>
<a id="tutoriel_fr.catala_fr-219" name="tutoriel_fr.catala_fr-219"></a><span class="kd">déclaration</span> <span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtDeuxTranches</span> <span class="o">:</span>
<a id="tutoriel_fr.catala_fr-220" name="tutoriel_fr.catala_fr-220"></a>  <span class="kd">contexte</span> <span class="nv">tranches</span> <span class="kd">contenu</span> <span class="nc">DeuxTranches</span>
<a id="tutoriel_fr.catala_fr-221" name="tutoriel_fr.catala_fr-221"></a>  <span class="kd">contexte</span> <span class="nv">formule_imposition</span> <span class="kd">contenu</span> <span class="kt">argent</span> <span class="kd">dépend de</span> <span class="kt">argent</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Et dans le code :</p>
<h4 class='law-heading'><a href='#'>Article4</a></h4>
<p class='law-text'>Le montant d'impôt pour le calcul à deux tranches
est égal au montant d'impôt dans chaque tranche multiplié
par le taux de chaque branche.</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-233">233</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-234">234</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-235">235</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-236">236</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-237">237</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-238">238</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-239">239</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-240">240</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-233" name="tutoriel_fr.catala_fr-233"></a><span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtDeuxTranches</span> <span class="o">:</span>
<a id="tutoriel_fr.catala_fr-234" name="tutoriel_fr.catala_fr-234"></a>  <span class="kd">définition</span> <span class="nv">formule_imposition</span> <span class="kr">de</span> <span class="nv">revenu</span> <span class="kd">égal à</span>
<a id="tutoriel_fr.catala_fr-235" name="tutoriel_fr.catala_fr-235"></a>    <span class="kr">si</span> <span class="nv">revenu</span> <span class="o">&lt;=€</span> <span class="nv">tranches</span><span class="o">.</span>seuil <span class="kr">alors</span>
<a id="tutoriel_fr.catala_fr-236" name="tutoriel_fr.catala_fr-236"></a>      <span class="nv">revenu</span> <span class="o">*€</span> <span class="nv">tranches</span><span class="o">.</span>taux1
<a id="tutoriel_fr.catala_fr-237" name="tutoriel_fr.catala_fr-237"></a>    <span class="kr">sinon</span> <span class="o">(</span>
<a id="tutoriel_fr.catala_fr-238" name="tutoriel_fr.catala_fr-238"></a>      <span class="nv">tranches</span><span class="o">.</span>seuil <span class="o">*€</span> <span class="nv">tranches</span><span class="o">.</span>taux1 <span class="o">+€</span>
<a id="tutoriel_fr.catala_fr-239" name="tutoriel_fr.catala_fr-239"></a>      <span class="o">(</span><span class="nv">revenu</span> <span class="o">-€</span> <span class="nv">tranches</span><span class="o">.</span>seuil<span class="o">)</span> <span class="o">*€</span> <span class="nv">tranches</span><span class="o">.</span>taux2
<a id="tutoriel_fr.catala_fr-240" name="tutoriel_fr.catala_fr-240"></a>    <span class="o">)</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Inclusion de champ d'application</a></h3>
<p class='law-text'>Maintenant que nous avons défini notre champ d'application utilitaire pour
calculer un impôt à deux tranches, nous voulons l'utiliser dans notre champ
d'application principal de calcul de l'impôt.</p>
<h4 class='law-heading'><a href='#'>Article 5</a></h4>
<p class='law-text'>Pour les individus dont le revenu est supérieur à 100 000€,
l'impôt sur le revenu de l'article 1 est de 40% du revenu au-dessus de
100 000€. En dessous de 100 000€, l'impôt sur le revenu est de 20% du revenu.</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-256">256</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-257">257</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-258">258</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-259">259</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-260">260</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-261">261</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-262">262</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-263">263</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-264">264</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-265">265</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-266">266</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-267">267</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-268">268</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-269">269</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-270">270</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-271">271</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-272">272</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-256" name="tutoriel_fr.catala_fr-256"></a><span class="kd">déclaration</span> <span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenu</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-257" name="tutoriel_fr.catala_fr-257"></a>  <span class="kd">contexte</span> <span class="nv">deux_tranches</span> <span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtDeuxTranches</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-258" name="tutoriel_fr.catala_fr-258"></a><span class="c1">  # Cette ligne indique que nous ajoutons l&#39;élément deux_tranches au contexte.</span>
<a id="tutoriel_fr.catala_fr-259" name="tutoriel_fr.catala_fr-259"></a><span class="c1">  # Toutefois, les mots clé &quot;champ d&#39;application&quot; indique que l&#39;élément n&#39;est</span>
<a id="tutoriel_fr.catala_fr-260" name="tutoriel_fr.catala_fr-260"></a><span class="c1">  # pas une donnée mais plutôt un sous-champ d&#39;application qui peut être</span>
<a id="tutoriel_fr.catala_fr-261" name="tutoriel_fr.catala_fr-261"></a><span class="c1">  # utilisé pour calculer des choses.</span>
<a id="tutoriel_fr.catala_fr-262" name="tutoriel_fr.catala_fr-262"></a>  <span class="kd">contexte</span> <span class="nv">personne</span> <span class="kd">contenu</span> <span class="nc">Personne</span>
<a id="tutoriel_fr.catala_fr-263" name="tutoriel_fr.catala_fr-263"></a>  <span class="kd">contexte</span> <span class="nv">impôt_revenu</span> <span class="kd">contenu</span> <span class="kt">argent</span>
<a id="tutoriel_fr.catala_fr-264" name="tutoriel_fr.catala_fr-264"></a>
<a id="tutoriel_fr.catala_fr-265" name="tutoriel_fr.catala_fr-265"></a><span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenu</span> <span class="o">:</span>
<a id="tutoriel_fr.catala_fr-266" name="tutoriel_fr.catala_fr-266"></a>  <span class="kd">définition</span> <span class="nv">deux_tranches</span><span class="o">.</span>tranches <span class="kd">égal à</span> <span class="nc">DeuxTranches</span> <span class="o">{</span>
<a id="tutoriel_fr.catala_fr-267" name="tutoriel_fr.catala_fr-267"></a>    <span class="o">--</span> <span class="nv">seuil</span><span class="o">:</span> <span class="mi">100</span> <span class="mi">000</span><span class="o">€</span>
<a id="tutoriel_fr.catala_fr-268" name="tutoriel_fr.catala_fr-268"></a>    <span class="o">--</span> <span class="nv">taux1</span><span class="o">:</span> <span class="mi">20</span><span class="o">%</span>
<a id="tutoriel_fr.catala_fr-269" name="tutoriel_fr.catala_fr-269"></a>    <span class="o">--</span> <span class="nv">taux2</span><span class="o">:</span> <span class="mi">40</span><span class="o">%</span>
<a id="tutoriel_fr.catala_fr-270" name="tutoriel_fr.catala_fr-270"></a>  <span class="o">}</span>
<a id="tutoriel_fr.catala_fr-271" name="tutoriel_fr.catala_fr-271"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">égal à</span>
<a id="tutoriel_fr.catala_fr-272" name="tutoriel_fr.catala_fr-272"></a>    <span class="nv">deux_tranches</span><span class="o">.</span>formule_imposition <span class="kr">de</span> <span class="nv">personne</span><span class="o">.</span>revenu
</pre></div>
</td></tr></table>
</div>

<h4 class='law-heading'><a href='#'>Article 6</a></h4>
<p class='law-text'>Les personnes ayant moins de 10 000€ de revenus sont exemptés de l'impôt
sur le revenu prévu à l'article 1.</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-281">281</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-282">282</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-283">283</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-284">284</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-281" name="tutoriel_fr.catala_fr-281"></a><span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenu</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-282" name="tutoriel_fr.catala_fr-282"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">sous condition</span>
<a id="tutoriel_fr.catala_fr-283" name="tutoriel_fr.catala_fr-283"></a>    <span class="nv">personne</span><span class="o">.</span>revenu <span class="o">&lt;=€</span> <span class="mi">10</span> <span class="mi">000</span><span class="o">€</span>
<a id="tutoriel_fr.catala_fr-284" name="tutoriel_fr.catala_fr-284"></a>  <span class="kd">conséquence</span> <span class="kd">égal à</span> <span class="mi">0</span><span class="o">€</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Et voilà ! Nous avons défini un calcul d'impôt à deux tranches en annotant
tout simplement un texte législatif par des bouts de code Catala.
Cependant, les lecteurs attentifs auront vu quelque chose de curieux dans les
articles 5 et 6. Que se passe-t-il si le revenu d'une personne se situe entre
10 000€ et 100 000€ ?<br/>
La loi ne le précise pas; nos articles sont clairement mal rédigés.
Mais Catala vous aide à trouver ce genre d'erreur par de simples tests ou
même la vérification formelle. Commençons par les tests.</p>
<h3 class='law-heading'><a href='#'>Tester les programmes Catala</a></h3>
<p class='law-text'>Tester les programmes Catala peut se faire directement en Catala. En effet,
écrire des cas de tests pour chaque champ d'application Catala que vous
définissez est une bonne pratique appelée "tests unitaires" dans la
communauté du génie logicielle. Les cas de test sont définis dans des
champ d'application :</p>
<h4 class='law-heading'><a href='#'>Tester NouveauCalculImpotRevenu</a></h4>

<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-308">308</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-309">309</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-310">310</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-311">311</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-312">312</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-313">313</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-314">314</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-315">315</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-316">316</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-317">317</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-318">318</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-319">319</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-320">320</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-321">321</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-322">322</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-323">323</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-324">324</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-325">325</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-326">326</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-327">327</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-328">328</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-329">329</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-308" name="tutoriel_fr.catala_fr-308"></a><span class="kd">déclaration</span> <span class="kd">champ d&#39;application</span> <span class="nc">Test1</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-309" name="tutoriel_fr.catala_fr-309"></a>  <span class="kd">contexte</span> <span class="nv">calcul_impôt</span> <span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenu</span>
<a id="tutoriel_fr.catala_fr-310" name="tutoriel_fr.catala_fr-310"></a>  <span class="kd">contexte</span> <span class="nv">impôt_revenu</span> <span class="kd">contenu</span> <span class="kt">argent</span>
<a id="tutoriel_fr.catala_fr-311" name="tutoriel_fr.catala_fr-311"></a>
<a id="tutoriel_fr.catala_fr-312" name="tutoriel_fr.catala_fr-312"></a><span class="kd">champ d&#39;application</span> <span class="nc">Test1</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-313" name="tutoriel_fr.catala_fr-313"></a>  <span class="kd">définition</span>
<a id="tutoriel_fr.catala_fr-314" name="tutoriel_fr.catala_fr-314"></a>    <span class="nv">calcul_impôt</span><span class="o">.</span>personne<span class="c1"></span>
<a id="tutoriel_fr.catala_fr-315" name="tutoriel_fr.catala_fr-315"></a><span class="c1">    # L&#39;on définit le paramètre au sous-champ d&#39;application</span>
<a id="tutoriel_fr.catala_fr-316" name="tutoriel_fr.catala_fr-316"></a>  <span class="kd">égal à</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-317" name="tutoriel_fr.catala_fr-317"></a><span class="c1">    # Les quatre lignes ci-dessous définissent une structure entière</span>
<a id="tutoriel_fr.catala_fr-318" name="tutoriel_fr.catala_fr-318"></a><span class="c1">    # en valorisant chacun des champs</span>
<a id="tutoriel_fr.catala_fr-319" name="tutoriel_fr.catala_fr-319"></a>    <span class="nc">Personne</span> <span class="o">{</span>
<a id="tutoriel_fr.catala_fr-320" name="tutoriel_fr.catala_fr-320"></a>      <span class="o">--</span> <span class="nv">revenu</span><span class="o">:</span> <span class="mi">230</span> <span class="mi">000</span><span class="o">€</span>
<a id="tutoriel_fr.catala_fr-321" name="tutoriel_fr.catala_fr-321"></a>      <span class="o">--</span> <span class="nv">nombre_enfants</span><span class="o">:</span> <span class="mi">0</span>
<a id="tutoriel_fr.catala_fr-322" name="tutoriel_fr.catala_fr-322"></a>    <span class="o">}</span>
<a id="tutoriel_fr.catala_fr-323" name="tutoriel_fr.catala_fr-323"></a>
<a id="tutoriel_fr.catala_fr-324" name="tutoriel_fr.catala_fr-324"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">égal à</span> <span class="nv">calcul_impôt</span><span class="o">.</span>impôt_revenu<span class="c1"></span>
<a id="tutoriel_fr.catala_fr-325" name="tutoriel_fr.catala_fr-325"></a><span class="c1">  # Ensuite, nous récupérons le montant d&#39;impôt, calculé par</span>
<a id="tutoriel_fr.catala_fr-326" name="tutoriel_fr.catala_fr-326"></a><span class="c1">  # sous-champ d&#39;application et nous assertons qu&#39;il vaut bien</span>
<a id="tutoriel_fr.catala_fr-327" name="tutoriel_fr.catala_fr-327"></a><span class="c1">  # la valeur attendue :</span>
<a id="tutoriel_fr.catala_fr-328" name="tutoriel_fr.catala_fr-328"></a><span class="c1">  # (230 000€ - 100 000€) * 40% + 100 000€ * 20% = 72 000€</span>
<a id="tutoriel_fr.catala_fr-329" name="tutoriel_fr.catala_fr-329"></a>  <span class="kd">assertion</span> <span class="nv">impôt_revenu</span> <span class="o">=</span> <span class="mi">72</span> <span class="mi">000</span><span class="o">€</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Ce test devrait être bon. Maintenant étudions un test en échec :</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-335">335</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-336">336</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-337">337</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-338">338</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-339">339</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-340">340</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-341">341</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-342">342</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-343">343</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-344">344</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-345">345</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-346">346</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-335" name="tutoriel_fr.catala_fr-335"></a><span class="kd">déclaration</span> <span class="kd">champ d&#39;application</span> <span class="nc">Test2</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-336" name="tutoriel_fr.catala_fr-336"></a>  <span class="kd">contexte</span> <span class="nv">calcul_impôt</span> <span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenu</span>
<a id="tutoriel_fr.catala_fr-337" name="tutoriel_fr.catala_fr-337"></a>  <span class="kd">contexte</span> <span class="nv">impôt_revenu</span> <span class="kd">contenu</span> <span class="kt">argent</span>
<a id="tutoriel_fr.catala_fr-338" name="tutoriel_fr.catala_fr-338"></a>
<a id="tutoriel_fr.catala_fr-339" name="tutoriel_fr.catala_fr-339"></a><span class="kd">champ d&#39;application</span> <span class="nc">Test2</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-340" name="tutoriel_fr.catala_fr-340"></a>  <span class="kd">définition</span> <span class="nv">calcul_impôt</span><span class="o">.</span>personne <span class="kd">égal à</span> <span class="nc">Personne</span> <span class="o">{</span>
<a id="tutoriel_fr.catala_fr-341" name="tutoriel_fr.catala_fr-341"></a>    <span class="o">--</span> <span class="nv">revenu</span><span class="o">:</span> <span class="mi">4</span> <span class="mi">000</span><span class="o">€</span>
<a id="tutoriel_fr.catala_fr-342" name="tutoriel_fr.catala_fr-342"></a>    <span class="o">--</span> <span class="nv">nombre_enfants</span><span class="o">:</span> <span class="mi">0</span>
<a id="tutoriel_fr.catala_fr-343" name="tutoriel_fr.catala_fr-343"></a>  <span class="o">}</span>
<a id="tutoriel_fr.catala_fr-344" name="tutoriel_fr.catala_fr-344"></a>
<a id="tutoriel_fr.catala_fr-345" name="tutoriel_fr.catala_fr-345"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">égal à</span> <span class="nv">calcul_impôt</span><span class="o">.</span>impôt_revenu
<a id="tutoriel_fr.catala_fr-346" name="tutoriel_fr.catala_fr-346"></a>  <span class="kd">assertion</span> <span class="nv">impôt_revenu</span> <span class="o">=</span> <span class="mi">0</span><span class="o">€</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Ce cas de test devrait calculer un impôt sur le revenu de 0€,
en raison de l'article 6. Mais au lieu de cela, l'exécution produira
une erreur car il y a un conflit entre les règles.</p>
<h3 class='law-heading'><a href='#'>Définir des exceptions à des règles</a></h3>
<p class='law-text'>En effet, la définition d'un impôt sur le revenu à l'article 6 entre en
conflit avec la définition de l'article 5. Mais en réalité, l'article 6
est une simple exception à l'article 5. Dans la loi, il est implicite que
si l'article 6 est applicable, alors son application est prioritaire
sur l'article 5.</p>
<h4 class='law-heading'><a href='#'>Régler correctement le calcul</a></h4>
<p class='law-text'>Cette priorité implicite doit être explicitement déclaré en Catala. Voici une
version correcte du champ d'application NouveauCalculImpotRevenu :</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-367">367</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-368">368</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-369">369</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-370">370</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-371">371</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-372">372</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-373">373</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-374">374</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-375">375</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-376">376</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-377">377</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-378">378</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-379">379</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-380">380</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-381">381</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-382">382</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-383">383</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-384">384</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-385">385</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-386">386</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-387">387</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-388">388</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-389">389</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-390">390</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-391">391</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-367" name="tutoriel_fr.catala_fr-367"></a><span class="kd">déclaration</span> <span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenuCorrect</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-368" name="tutoriel_fr.catala_fr-368"></a>  <span class="kd">contexte</span> <span class="nv">deux_tranches</span> <span class="kd">champ d&#39;application</span> <span class="nc">CalculImpôtDeuxTranches</span>
<a id="tutoriel_fr.catala_fr-369" name="tutoriel_fr.catala_fr-369"></a>  <span class="kd">contexte</span> <span class="nv">personne</span> <span class="kd">contenu</span> <span class="nc">Personne</span>
<a id="tutoriel_fr.catala_fr-370" name="tutoriel_fr.catala_fr-370"></a>  <span class="kd">contexte</span> <span class="nv">impôt_revenu</span> <span class="kd">contenu</span> <span class="kt">argent</span>
<a id="tutoriel_fr.catala_fr-371" name="tutoriel_fr.catala_fr-371"></a>
<a id="tutoriel_fr.catala_fr-372" name="tutoriel_fr.catala_fr-372"></a><span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenuCorrect</span> <span class="o">:</span>
<a id="tutoriel_fr.catala_fr-373" name="tutoriel_fr.catala_fr-373"></a>  <span class="kd">définition</span> <span class="nv">deux_tranches</span><span class="o">.</span>tranches <span class="kd">égal à</span> <span class="nc">DeuxTranches</span> <span class="o">{</span>
<a id="tutoriel_fr.catala_fr-374" name="tutoriel_fr.catala_fr-374"></a>    <span class="o">--</span> <span class="nv">seuil</span><span class="o">:</span> <span class="mi">100</span> <span class="mi">000</span><span class="o">€</span>
<a id="tutoriel_fr.catala_fr-375" name="tutoriel_fr.catala_fr-375"></a>    <span class="o">--</span> <span class="nv">taux1</span><span class="o">:</span> <span class="mi">20</span><span class="o">%</span>
<a id="tutoriel_fr.catala_fr-376" name="tutoriel_fr.catala_fr-376"></a>    <span class="o">--</span> <span class="nv">taux2</span><span class="o">:</span> <span class="mi">40</span><span class="o">%</span>
<a id="tutoriel_fr.catala_fr-377" name="tutoriel_fr.catala_fr-377"></a>  <span class="o">}</span><span class="c1"></span>
<a id="tutoriel_fr.catala_fr-378" name="tutoriel_fr.catala_fr-378"></a>
<a id="tutoriel_fr.catala_fr-379" name="tutoriel_fr.catala_fr-379"></a>
<a id="tutoriel_fr.catala_fr-380" name="tutoriel_fr.catala_fr-380"></a><span class="c1">  # Pour définir une exception à une règle, vous devez d&#39;abord étiquetter</span>
<a id="tutoriel_fr.catala_fr-381" name="tutoriel_fr.catala_fr-381"></a><span class="c1">  # la règle à laquelle vous voulez attacher l&#39;exception. Vous pouvez mettre</span>
<a id="tutoriel_fr.catala_fr-382" name="tutoriel_fr.catala_fr-382"></a><span class="c1">  # n&#39;importe quel identifiant en snake_case pour l&#39;étiquette.</span>
<a id="tutoriel_fr.catala_fr-383" name="tutoriel_fr.catala_fr-383"></a>  <span class="kd">étiquette</span> <span class="nv">article_5</span>
<a id="tutoriel_fr.catala_fr-384" name="tutoriel_fr.catala_fr-384"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">égal à</span>
<a id="tutoriel_fr.catala_fr-385" name="tutoriel_fr.catala_fr-385"></a>    <span class="nv">deux_tranches</span><span class="o">.</span>formule_imposition <span class="kr">de</span> <span class="nv">personne</span><span class="o">.</span>revenu<span class="c1"></span>
<a id="tutoriel_fr.catala_fr-386" name="tutoriel_fr.catala_fr-386"></a>
<a id="tutoriel_fr.catala_fr-387" name="tutoriel_fr.catala_fr-387"></a><span class="c1">  # Puis, vous pouvez déclarez l&#39;exception par référence à l&#39;étiquette</span>
<a id="tutoriel_fr.catala_fr-388" name="tutoriel_fr.catala_fr-388"></a>  <span class="kd">exception</span> <span class="nv">article_5</span>
<a id="tutoriel_fr.catala_fr-389" name="tutoriel_fr.catala_fr-389"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">sous condition</span>
<a id="tutoriel_fr.catala_fr-390" name="tutoriel_fr.catala_fr-390"></a>    <span class="nv">personne</span><span class="o">.</span>revenu <span class="o">&lt;=€</span> <span class="mi">10</span> <span class="mi">000</span><span class="o">€</span>
<a id="tutoriel_fr.catala_fr-391" name="tutoriel_fr.catala_fr-391"></a>  <span class="kd">conséquence</span> <span class="kd">égal à</span> <span class="mi">0</span><span class="o">€</span>
</pre></div>
</td></tr></table>
</div>
<p class='law-text'>Le test devrait désormais fonctionner :</p>
<div class='code-wrapper'>
<div class='filename'>tutoriel_fr.catala_fr</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutoriel_fr.catala_fr-397">397</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-398">398</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-399">399</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-400">400</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-401">401</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-402">402</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-403">403</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-404">404</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-405">405</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-406">406</a></span>
<span class="normal"><a href="#tutoriel_fr.catala_fr-407">407</a></span>
</pre></div></td><td class="code"><div class="highlight"><pre>
<a id="tutoriel_fr.catala_fr-397" name="tutoriel_fr.catala_fr-397"></a><span class="kd">déclaration</span> <span class="kd">champ d&#39;application</span> <span class="nc">Test3</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-398" name="tutoriel_fr.catala_fr-398"></a>  <span class="kd">contexte</span> <span class="nv">calcul_impôt</span> <span class="kd">champ d&#39;application</span> <span class="nc">NouveauCalculImpôtRevenuCorrect</span>
<a id="tutoriel_fr.catala_fr-399" name="tutoriel_fr.catala_fr-399"></a>  <span class="kd">contexte</span> <span class="nv">impôt_revenu</span> <span class="kd">contenu</span> <span class="kt">argent</span>
<a id="tutoriel_fr.catala_fr-400" name="tutoriel_fr.catala_fr-400"></a>
<a id="tutoriel_fr.catala_fr-401" name="tutoriel_fr.catala_fr-401"></a><span class="kd">champ d&#39;application</span> <span class="nc">Test3</span><span class="o">:</span>
<a id="tutoriel_fr.catala_fr-402" name="tutoriel_fr.catala_fr-402"></a>  <span class="kd">définition</span> <span class="nv">calcul_impôt</span><span class="o">.</span>personne <span class="kd">égal à</span> <span class="nc">Personne</span> <span class="o">{</span>
<a id="tutoriel_fr.catala_fr-403" name="tutoriel_fr.catala_fr-403"></a>    <span class="o">--</span> <span class="nv">revenu</span><span class="o">:</span> <span class="mi">4</span> <span class="mi">000</span><span class="o">€</span>
<a id="tutoriel_fr.catala_fr-404" name="tutoriel_fr.catala_fr-404"></a>    <span class="o">--</span> <span class="nv">nombre_enfants</span><span class="o">:</span> <span class="mi">0</span>
<a id="tutoriel_fr.catala_fr-405" name="tutoriel_fr.catala_fr-405"></a>  <span class="o">}</span>
<a id="tutoriel_fr.catala_fr-406" name="tutoriel_fr.catala_fr-406"></a>  <span class="kd">définition</span> <span class="nv">impôt_revenu</span> <span class="kd">égal à</span> <span class="nv">calcul_impôt</span><span class="o">.</span>impôt_revenu
<a id="tutoriel_fr.catala_fr-407" name="tutoriel_fr.catala_fr-407"></a>  <span class="kd">assertion</span> <span class="nv">impôt_revenu</span> <span class="o">=</span> <span class="mi">0</span><span class="o">€</span>
</pre></div>
</td></tr></table>
</div>

<h3 class='law-heading'><a href='#'>Conclusion</a></h3>
<p class='law-text'>Ce tutoriel présente les concepts de base et la syntaxe des fonctionnalités
du langage Catala. C'est à vous de les utiliser pour annoter du texte
législatif avec leur traduction algorithmique.<br/>
Il n'y pas une seule bonne façon d'écrire des programmes Catala car le style de
programmation doit être adapté au texte de loi annoté. Cependant, Catala est un
langage basé sur la programmation fonctionnelle, donc suivre les
patrons de conception habituels de la programmation fonctionnelle
devrait aider à obtenir du code concis et lisible.</p>