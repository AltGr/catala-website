<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Desugaring (catala.Surface.Desugaring)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">catala</a> &#x00BB; <a href="../index.html">Surface</a> &#x00BB; Desugaring</nav><h1>Module <code>Surface.Desugaring</code></h1><nav class="toc"><ul><li><a href="#translating-expressions">Translating expressions</a></li><li><a href="#translating-scope-definitions">Translating scope definitions</a></li><li><a href="#translating-top-level-items">Translating top-level items</a></li></ul></nav></header><aside><p>Translation from <a href="../Ast/index.html"><code>Ast</code></a> to <span class="xref-unresolved" title="unresolved reference to &quot;Desugaring.Ast&quot;"><a href="../index.html#module-Desugaring"><code>Desugaring</code></a>.Ast</span>.</p><ul><li>Removes syntactic sugars</li><li>Separate code from legislation</li></ul></aside><section><header><h2 id="translating-expressions"><a href="#translating-expressions" class="anchor"></a>Translating expressions</h2></header><dl><dt class="spec value" id="val-translate_op_kind"><a href="#val-translate_op_kind" class="anchor"></a><code><span class="keyword">val</span> translate_op_kind : <a href="../Ast/index.html#type-op_kind">Ast.op_kind</a> <span>&#45;&gt;</span> <a href="../../Dcalc/Ast/index.html#type-op_kind">Dcalc.Ast.op_kind</a></code></dt><dt class="spec value" id="val-translate_binop"><a href="#val-translate_binop" class="anchor"></a><code><span class="keyword">val</span> translate_binop : <a href="../Ast/index.html#type-binop">Ast.binop</a> <span>&#45;&gt;</span> <a href="../../Dcalc/Ast/index.html#type-binop">Dcalc.Ast.binop</a></code></dt><dt class="spec value" id="val-translate_unop"><a href="#val-translate_unop" class="anchor"></a><code><span class="keyword">val</span> translate_unop : <a href="../Ast/index.html#type-unop">Ast.unop</a> <span>&#45;&gt;</span> <a href="../../Dcalc/Ast/index.html#type-unop">Dcalc.Ast.unop</a></code></dt></dl><aside><p>The two modules below help performing operations on map with the <span class="xref-unresolved" title="unresolved reference to &quot;Bindlib.box&quot;"><code>Bindlib</code>.box</span>. Indeed, Catala uses the <a href="https://lepigre.fr/ocaml-bindlib/">Bindlib</a> library to represent bound variables in the AST. In this translation, bound variables are used to represent function parameters or pattern macthing bindings.</p></aside><div class="spec module" id="module-LiftStructFieldMap"><a href="#module-LiftStructFieldMap" class="anchor"></a><code><span class="keyword">module</span> <a href="LiftStructFieldMap/index.html">LiftStructFieldMap</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-LiftEnumConstructorMap"><a href="#module-LiftEnumConstructorMap" class="anchor"></a><code><span class="keyword">module</span> <a href="LiftEnumConstructorMap/index.html">LiftEnumConstructorMap</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-disambiguate_constructor"><a href="#val-disambiguate_constructor" class="anchor"></a><code><span class="keyword">val</span> disambiguate_constructor : <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <span><span>string <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> list</span> <span>&#45;&gt;</span> <a href="../../Utils/Pos/index.html#type-t">Utils.Pos.t</a> <span>&#45;&gt;</span> <a href="../../Scopelang/Ast/EnumName/index.html#type-t">Scopelang.Ast.EnumName.t</a> * <a href="../../Scopelang/Ast/EnumConstructor/index.html#type-t">Scopelang.Ast.EnumConstructor.t</a></code></dt><dt class="spec value" id="val-translate_expr"><a href="#val-translate_expr" class="anchor"></a><code><span class="keyword">val</span> translate_expr : <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <span><a href="../Ast/index.html#type-expression">Ast.expression</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> <span>&#45;&gt;</span> <span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span></code></dt><dd><p>Usage: <code>translate_expr scope ctxt expr</code></p><p>Translates <code>expr</code> into its desugared equivalent. <code>scope</code> is used to disambiguate the scope and subscopes variables than occur in the expresion</p></dd></dl><dl><dt class="spec value" id="val-disambiguate_match_and_build_expression"><a href="#val-disambiguate_match_and_build_expression" class="anchor"></a><code><span class="keyword">val</span> disambiguate_match_and_build_expression : <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../Ast/index.html#type-match_cases">Ast.match_cases</a> <span>&#45;&gt;</span> <span><span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span> <a href="../../Scopelang__Ast/index.html#module-EnumConstructorMap">Scopelang.Ast.EnumConstructorMap</a>.t</span> * <a href="../../Scopelang/Ast/EnumName/index.html#type-t">Scopelang.Ast.EnumName.t</a></code></dt></dl></section><section><header><h2 id="translating-scope-definitions"><a href="#translating-scope-definitions" class="anchor"></a>Translating scope definitions</h2></header><dl><dt class="spec value" id="val-merge_conditions"><a href="#val-merge_conditions" class="anchor"></a><code><span class="keyword">val</span> merge_conditions : <span><span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span> option</span> <span>&#45;&gt;</span> <span><span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span> option</span> <span>&#45;&gt;</span> <a href="../../Utils/Pos/index.html#type-t">Utils.Pos.t</a> <span>&#45;&gt;</span> <span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span></code></dt><dd><p>A scope use can be annotated with a pervasive precondition, in which case this precondition has to be appended to the justifications of each definition in the subscope use. This is what this function does.</p></dd></dl><dl><dt class="spec value" id="val-process_default"><a href="#val-process_default" class="anchor"></a><code><span class="keyword">val</span> process_default : <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <span><a href="../../Desugared/Ast/ScopeDef/index.html#type-t">Desugared.Ast.ScopeDef.t</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> <span>&#45;&gt;</span> <span><span><a href="../../Scopelang/Ast/Var/index.html#type-t">Scopelang.Ast.Var.t</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> option</span> <span>&#45;&gt;</span> <span><span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span> option</span> <span>&#45;&gt;</span> <span><span><a href="../../Desugared/Ast/RuleName/index.html#type-t">Desugared.Ast.RuleName.t</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> option</span> <span>&#45;&gt;</span> <span><span><a href="../Ast/index.html#type-expression">Ast.expression</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> option</span> <span>&#45;&gt;</span> <span><a href="../Ast/index.html#type-expression">Ast.expression</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-rule">Desugared.Ast.rule</a></code></dt><dd><p>Translates a surface definition into condition into a desugared <a href="../../Desugared/Ast/index.html#type-rule"><code>Ast.rule</code></a></p></dd></dl><dl><dt class="spec value" id="val-process_def"><a href="#val-process_def" class="anchor"></a><code><span class="keyword">val</span> process_def : <span><span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span> option</span> <span>&#45;&gt;</span> <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a> <span>&#45;&gt;</span> <a href="../Ast/index.html#type-definition">Ast.definition</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a></code></dt><dd><p>Wrapper around <a href="index.html#val-process_default"><code>process_default</code></a> that performs some name disambiguation</p></dd></dl><dl><dt class="spec value" id="val-rule_to_def"><a href="#val-rule_to_def" class="anchor"></a><code><span class="keyword">val</span> rule_to_def : <a href="../Ast/index.html#type-rule">Ast.rule</a> <span>&#45;&gt;</span> <a href="../Ast/index.html#type-definition">Ast.definition</a></code></dt><dd><p>Translates a <a href="../Ast/index.html#type-rule"><code>Ast.rule</code></a> into the corresponding <a href="../Ast/index.html#type-definition"><code>Ast.definition</code></a></p></dd></dl><dl><dt class="spec value" id="val-process_rule"><a href="#val-process_rule" class="anchor"></a><code><span class="keyword">val</span> process_rule : <span><span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span> option</span> <span>&#45;&gt;</span> <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a> <span>&#45;&gt;</span> <a href="../Ast/index.html#type-rule">Ast.rule</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a></code></dt><dd><p>Translates a <a href="../Ast/index.html#type-rule"><code>Ast.rule</code></a> from the surface language</p></dd></dl><dl><dt class="spec value" id="val-process_assert"><a href="#val-process_assert" class="anchor"></a><code><span class="keyword">val</span> process_assert : <span><span><span><a href="../../Scopelang/Ast/index.html#type-expr">Scopelang.Ast.expr</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> Bindlib.box</span> option</span> <span>&#45;&gt;</span> <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a> <span>&#45;&gt;</span> <a href="../Ast/index.html#type-assertion">Ast.assertion</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a></code></dt><dd><p>Translates assertions</p></dd></dl><dl><dt class="spec value" id="val-process_scope_use_item"><a href="#val-process_scope_use_item" class="anchor"></a><code><span class="keyword">val</span> process_scope_use_item : <span><span><a href="../Ast/index.html#type-expression">Ast.expression</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> option</span> <span>&#45;&gt;</span> <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a> <span>&#45;&gt;</span> <span><a href="../Ast/index.html#type-scope_use_item">Ast.scope_use_item</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a></code></dt><dd><p>Translates a surface definition, rule or assertion</p></dd></dl></section><section><header><h2 id="translating-top-level-items"><a href="#translating-top-level-items" class="anchor"></a>Translating top-level items</h2></header><dl><dt class="spec value" id="val-check_unlabeled_exception"><a href="#val-check_unlabeled_exception" class="anchor"></a><code><span class="keyword">val</span> check_unlabeled_exception : <a href="../../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <span><a href="../Ast/index.html#type-scope_use_item">Ast.scope_use_item</a> <a href="../../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-process_scope_use"><a href="#val-process_scope_use" class="anchor"></a><code><span class="keyword">val</span> process_scope_use : <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a> <span>&#45;&gt;</span> <a href="../Ast/index.html#type-scope_use">Ast.scope_use</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a></code></dt><dd><p>Translates a surface scope use, which is a bunch of definitions</p></dd></dl><dl><dt class="spec value" id="val-desugar_program"><a href="#val-desugar_program" class="anchor"></a><code><span class="keyword">val</span> desugar_program : <a href="../Name_resolution/index.html#type-context">Name_resolution.context</a> <span>&#45;&gt;</span> <a href="../Ast/index.html#type-program">Ast.program</a> <span>&#45;&gt;</span> <a href="../../Desugared/Ast/index.html#type-program">Desugared.Ast.program</a></code></dt><dd><p>Main function of this module</p></dd></dl></section></div></body></html>