<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Surface__Name_resolution (catala.Surface__Name_resolution)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">catala</a> &#x00BB; Surface__Name_resolution</nav><h1>Module <code>Surface__Name_resolution</code></h1><p>Builds a context that allows for mapping each name to a precise uid, taking lexical scopes into account</p></header><div class="spec module" id="module-Pos"><a href="#module-Pos" class="anchor"></a><code><span class="keyword">module</span> Pos = <a href="../Utils/index.html#module-Pos">Utils.Pos</a></code></div><div class="spec module" id="module-Errors"><a href="#module-Errors" class="anchor"></a><code><span class="keyword">module</span> Errors = <a href="../Utils/index.html#module-Errors">Utils.Errors</a></code></div><dl><dt class="spec type" id="type-ident"><a href="#type-ident" class="anchor"></a><code><span class="keyword">type</span> ident</code><code> = string</code></dt><dt class="spec type" id="type-typ"><a href="#type-typ" class="anchor"></a><code><span class="keyword">type</span> typ</code><code> = <a href="../Dcalc/Ast/index.html#type-typ">Dcalc.Ast.typ</a></code></dt><dt class="spec type" id="type-def_context"><a href="#type-def_context" class="anchor"></a><code><span class="keyword">type</span> def_context</code><code> = </code><code>{</code><table class="record"><tr id="type-def_context.var_idmap" class="anchored"><td class="def field"><a href="#type-def_context.var_idmap" class="anchor"></a><code>var_idmap : <span><a href="../Scopelang/Ast/Var/index.html#type-t">Scopelang.Ast.Var.t</a> <a href="../Desugared/Ast/IdentMap/index.html#type-t">Desugared.Ast.IdentMap.t</a></span>;</code></td></tr></table><code>}</code></dt><dd><p>Inside a definition, local variables can be introduced by functions arguments or pattern matching</p></dd></dl><dl><dt class="spec type" id="type-scope_context"><a href="#type-scope_context" class="anchor"></a><code><span class="keyword">type</span> scope_context</code><code> = </code><code>{</code><table class="record"><tr id="type-scope_context.var_idmap" class="anchored"><td class="def field"><a href="#type-scope_context.var_idmap" class="anchor"></a><code>var_idmap : <span><a href="../Scopelang/Ast/ScopeVar/index.html#type-t">Scopelang.Ast.ScopeVar.t</a> <a href="../Desugared/Ast/IdentMap/index.html#type-t">Desugared.Ast.IdentMap.t</a></span>;</code></td></tr><tr id="type-scope_context.sub_scopes_idmap" class="anchored"><td class="def field"><a href="#type-scope_context.sub_scopes_idmap" class="anchor"></a><code>sub_scopes_idmap : <span><a href="../Scopelang/Ast/SubScopeName/index.html#type-t">Scopelang.Ast.SubScopeName.t</a> <a href="../Desugared/Ast/IdentMap/index.html#type-t">Desugared.Ast.IdentMap.t</a></span>;</code></td></tr><tr id="type-scope_context.sub_scopes" class="anchored"><td class="def field"><a href="#type-scope_context.sub_scopes" class="anchor"></a><code>sub_scopes : <span><a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <a href="../Scopelang/Ast/SubScopeMap/index.html#type-t">Scopelang.Ast.SubScopeMap.t</a></span>;</code></td></tr><tr id="type-scope_context.definitions" class="anchored"><td class="def field"><a href="#type-scope_context.definitions" class="anchor"></a><code>definitions : <span><a href="index.html#type-def_context">def_context</a> <a href="../Desugared/Ast/ScopeDefMap/index.html#type-t">Desugared.Ast.ScopeDefMap.t</a></span>;</code></td><td class="doc"><p>Contains the local variables in all the definitions</p></td></tr></table><code>}</code></dt><dd><p>Inside a scope, we distinguish between the variables and the subscopes.</p></dd></dl><dl><dt class="spec type" id="type-context"><a href="#type-context" class="anchor"></a><code><span class="keyword">type</span> context</code><code> = </code><code>{</code><table class="record"><tr id="type-context.scope_idmap" class="anchored"><td class="def field"><a href="#type-context.scope_idmap" class="anchor"></a><code>scope_idmap : <span><a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <a href="../Desugared/Ast/IdentMap/index.html#type-t">Desugared.Ast.IdentMap.t</a></span>;</code></td></tr><tr id="type-context.scopes" class="anchored"><td class="def field"><a href="#type-context.scopes" class="anchor"></a><code>scopes : <span><a href="index.html#type-scope_context">scope_context</a> <a href="../Scopelang/Ast/ScopeMap/index.html#type-t">Scopelang.Ast.ScopeMap.t</a></span>;</code></td></tr><tr id="type-context.var_typs" class="anchored"><td class="def field"><a href="#type-context.var_typs" class="anchor"></a><code>var_typs : <span><span><a href="index.html#type-typ">typ</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <a href="../Scopelang/Ast/ScopeVarMap/index.html#type-t">Scopelang.Ast.ScopeVarMap.t</a></span>;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec value" id="val-raise_unsupported_feature"><a href="#val-raise_unsupported_feature" class="anchor"></a><code><span class="keyword">val</span> raise_unsupported_feature : string <span>&#45;&gt;</span> <a href="../Utils/Pos/index.html#type-t">Pos.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-raise_unknown_identifier"><a href="#val-raise_unknown_identifier" class="anchor"></a><code><span class="keyword">val</span> raise_unknown_identifier : string <span>&#45;&gt;</span> <span><a href="index.html#type-ident">ident</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-get_var_typ"><a href="#val-get_var_typ" class="anchor"></a><code><span class="keyword">val</span> get_var_typ : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Scopelang/Ast/ScopeVar/index.html#type-t">Scopelang.Ast.ScopeVar.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-typ">typ</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span></code></dt><dd><p>Get the type associated to an uid</p></dd></dl><dl><dt class="spec value" id="val-process_subscope_decl"><a href="#val-process_subscope_decl" class="anchor"></a><code><span class="keyword">val</span> process_subscope_decl : <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-scope_decl_context_scope">Surface.Ast.scope_decl_context_scope</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a subscope declaration</p></dd></dl><dl><dt class="spec value" id="val-process_base_typ"><a href="#val-process_base_typ" class="anchor"></a><code><span class="keyword">val</span> process_base_typ : <span><a href="../Surface/Ast/index.html#type-base_typ">Surface.Ast.base_typ</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <span><a href="../Dcalc/Ast/index.html#type-typ">Dcalc.Ast.typ</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span></code></dt><dt class="spec value" id="val-process_type"><a href="#val-process_type" class="anchor"></a><code><span class="keyword">val</span> process_type : <span><a href="../Surface/Ast/index.html#type-typ">Surface.Ast.typ</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <span><a href="../Dcalc/Ast/index.html#type-typ">Dcalc.Ast.typ</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span></code></dt><dt class="spec value" id="val-process_data_decl"><a href="#val-process_data_decl" class="anchor"></a><code><span class="keyword">val</span> process_data_decl : <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-scope_decl_context_data">Surface.Ast.scope_decl_context_data</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process data declaration</p></dd></dl><dl><dt class="spec value" id="val-process_item_decl"><a href="#val-process_item_decl" class="anchor"></a><code><span class="keyword">val</span> process_item_decl : <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-scope_decl_context_item">Surface.Ast.scope_decl_context_item</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process an item declaration</p></dd></dl><dl><dt class="spec value" id="val-add_def_local_var"><a href="#val-add_def_local_var" class="anchor"></a><code><span class="keyword">val</span> add_def_local_var : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="../Desugared/Ast/ScopeDef/index.html#type-t">Desugared.Ast.ScopeDef.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-ident">ident</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Adds a binding to the context</p></dd></dl><dl><dt class="spec value" id="val-process_scope_decl"><a href="#val-process_scope_decl" class="anchor"></a><code><span class="keyword">val</span> process_scope_decl : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-scope_decl">Surface.Ast.scope_decl</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a scope declaration</p></dd></dl><dl><dt class="spec value" id="val-qident_to_scope_def"><a href="#val-qident_to_scope_def" class="anchor"></a><code><span class="keyword">val</span> qident_to_scope_def : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <span><a href="../Surface/Ast/index.html#type-qident">Surface.Ast.qident</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="../Desugared/Ast/ScopeDef/index.html#type-t">Desugared.Ast.ScopeDef.t</a></code></dt><dt class="spec value" id="val-process_scope_use"><a href="#val-process_scope_use" class="anchor"></a><code><span class="keyword">val</span> process_scope_use : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-scope_use">Surface.Ast.scope_use</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dt class="spec value" id="val-process_use_item"><a href="#val-process_use_item" class="anchor"></a><code><span class="keyword">val</span> process_use_item : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../Surface/Ast/index.html#type-code_item">Surface.Ast.code_item</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a code item : for now it only handles scope decls</p></dd></dl><dl><dt class="spec value" id="val-process_decl_item"><a href="#val-process_decl_item" class="anchor"></a><code><span class="keyword">val</span> process_decl_item : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../Surface/Ast/index.html#type-code_item">Surface.Ast.code_item</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a code item : for now it only handles scope decls</p></dd></dl><dl><dt class="spec value" id="val-process_code_block"><a href="#val-process_code_block" class="anchor"></a><code><span class="keyword">val</span> process_code_block : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-code_block">Surface.Ast.code_block</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../Surface/Ast/index.html#type-code_item">Surface.Ast.code_item</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a>)</span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a code block</p></dd></dl><dl><dt class="spec value" id="val-process_law_article_item"><a href="#val-process_law_article_item" class="anchor"></a><code><span class="keyword">val</span> process_law_article_item : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-law_article_item">Surface.Ast.law_article_item</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../Surface/Ast/index.html#type-code_item">Surface.Ast.code_item</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a>)</span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a program item</p></dd></dl><dl><dt class="spec value" id="val-process_law_structure"><a href="#val-process_law_structure" class="anchor"></a><code><span class="keyword">val</span> process_law_structure : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-law_structure">Surface.Ast.law_structure</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../Surface/Ast/index.html#type-code_item">Surface.Ast.code_item</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a>)</span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a law structure</p></dd></dl><dl><dt class="spec value" id="val-process_program_item"><a href="#val-process_program_item" class="anchor"></a><code><span class="keyword">val</span> process_program_item : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Surface/Ast/index.html#type-program_item">Surface.Ast.program_item</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="../Surface/Ast/index.html#type-code_item">Surface.Ast.code_item</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a>)</span> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Process a program item</p></dd></dl><dl><dt class="spec value" id="val-form_context"><a href="#val-form_context" class="anchor"></a><code><span class="keyword">val</span> form_context : <a href="../Surface/Ast/index.html#type-program">Surface.Ast.program</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Derive the context from metadata, in two passes</p></dd></dl><dl><dt class="spec value" id="val-get_var_uid"><a href="#val-get_var_uid" class="anchor"></a><code><span class="keyword">val</span> get_var_uid : <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="index.html#type-ident">ident</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="../Scopelang/Ast/ScopeVar/index.html#type-t">Scopelang.Ast.ScopeVar.t</a></code></dt><dd><p>Get the variable uid inside the scope given in argument</p></dd></dl><dl><dt class="spec value" id="val-get_subscope_uid"><a href="#val-get_subscope_uid" class="anchor"></a><code><span class="keyword">val</span> get_subscope_uid : <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <span><a href="index.html#type-ident">ident</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span> <span>&#45;&gt;</span> <a href="../Scopelang/Ast/SubScopeName/index.html#type-t">Scopelang.Ast.SubScopeName.t</a></code></dt><dd><p>Get the subscope uid inside the scope given in argument</p></dd></dl><dl><dt class="spec value" id="val-belongs_to"><a href="#val-belongs_to" class="anchor"></a><code><span class="keyword">val</span> belongs_to : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Scopelang/Ast/ScopeVar/index.html#type-t">Scopelang.Ast.ScopeVar.t</a> <span>&#45;&gt;</span> <a href="../Scopelang/Ast/ScopeName/index.html#type-t">Scopelang.Ast.ScopeName.t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Checks if the var_uid belongs to the scope scope_uid</p></dd></dl><dl><dt class="spec value" id="val-get_def_typ"><a href="#val-get_def_typ" class="anchor"></a><code><span class="keyword">val</span> get_def_typ : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../Desugared/Ast/ScopeDef/index.html#type-t">Desugared.Ast.ScopeDef.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-typ">typ</a> <a href="../Utils/Pos/index.html#type-marked">Pos.marked</a></span></code></dt></dl></div></body></html>