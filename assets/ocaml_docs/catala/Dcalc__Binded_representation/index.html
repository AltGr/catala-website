<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dcalc__Binded_representation (catala.Dcalc__Binded_representation)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">catala</a> &#x00BB; Dcalc__Binded_representation</nav><h1>Module <code>Dcalc__Binded_representation</code></h1></header><div class="spec module" id="module-D"><a href="#module-D" class="anchor"></a><code><span class="keyword">module</span> D = <a href="../Dcalc/index.html#module-Ast">Dcalc.Ast</a></code></div><aside><p>Alternative representation of the Dcalc Ast. It is currently used in the transformation without exceptions. We make heavy use of bindlib, binding each scope-let-variable and each scope explicitly.</p></aside><dl><dt class="spec type" id="type-scope_lets"><a href="#type-scope_lets" class="anchor"></a><code><span class="keyword">type</span> scope_lets</code><code> = </code><table class="variant"><tr id="type-scope_lets.Result" class="anchored"><td class="def constructor"><a href="#type-scope_lets.Result" class="anchor"></a><code>| </code><code><span class="constructor">Result</span> <span class="keyword">of</span> <span><a href="../Dcalc/Ast/index.html#type-expr">D.expr</a> <a href="../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span></code></td></tr><tr id="type-scope_lets.ScopeLet" class="anchored"><td class="def constructor"><a href="#type-scope_lets.ScopeLet" class="anchor"></a><code>| </code><code><span class="constructor">ScopeLet</span> <span class="keyword">of</span> </code><code>{</code><table class="record"><tr id="type-scope_lets.scope_let_kind" class="anchored"><td class="def field"><a href="#type-scope_lets.scope_let_kind" class="anchor"></a><code>scope_let_kind : <a href="../Dcalc/Ast/index.html#type-scope_let_kind">D.scope_let_kind</a>;</code></td></tr><tr id="type-scope_lets.scope_let_typ" class="anchored"><td class="def field"><a href="#type-scope_lets.scope_let_typ" class="anchor"></a><code>scope_let_typ : <span><a href="../Dcalc/Ast/index.html#type-typ">D.typ</a> <a href="../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span>;</code></td></tr><tr id="type-scope_lets.scope_let_expr" class="anchored"><td class="def field"><a href="#type-scope_lets.scope_let_expr" class="anchor"></a><code>scope_let_expr : <span><a href="../Dcalc/Ast/index.html#type-expr">D.expr</a> <a href="../Utils/Pos/index.html#type-marked">Utils.Pos.marked</a></span>;</code></td></tr><tr id="type-scope_lets.scope_let_next" class="anchored"><td class="def field"><a href="#type-scope_lets.scope_let_next" class="anchor"></a><code>scope_let_next : <span><span>(<a href="../Dcalc/Ast/index.html#type-expr">D.expr</a>, <a href="index.html#type-scope_lets">scope_lets</a>)</span> Bindlib.binder</span>;</code></td></tr><tr id="type-scope_lets.scope_let_pos" class="anchored"><td class="def field"><a href="#type-scope_lets.scope_let_pos" class="anchor"></a><code>scope_let_pos : <a href="../Utils/Pos/index.html#type-t">Utils.Pos.t</a>;</code></td></tr></table><code>}</code></td></tr></table></dt><dd><p>In <code>Ast</code>, <code>Ast.scope_lets</code> is defined as a list of kind, var, and boxed expression. This representation binds using bindlib the tail of the list with the variable defined in the let.</p></dd></dl><dl><dt class="spec type" id="type-scope_body"><a href="#type-scope_body" class="anchor"></a><code><span class="keyword">type</span> scope_body</code><code> = </code><code>{</code><table class="record"><tr id="type-scope_body.scope_body_input_struct" class="anchored"><td class="def field"><a href="#type-scope_body.scope_body_input_struct" class="anchor"></a><code>scope_body_input_struct : <a href="../Dcalc__Ast/StructName/index.html#type-t">D.StructName.t</a>;</code></td></tr><tr id="type-scope_body.scope_body_output_struct" class="anchored"><td class="def field"><a href="#type-scope_body.scope_body_output_struct" class="anchor"></a><code>scope_body_output_struct : <a href="../Dcalc__Ast/StructName/index.html#type-t">D.StructName.t</a>;</code></td></tr><tr id="type-scope_body.scope_body_result" class="anchored"><td class="def field"><a href="#type-scope_body.scope_body_result" class="anchor"></a><code>scope_body_result : <span><span>(<a href="../Dcalc/Ast/index.html#type-expr">D.expr</a>, <a href="index.html#type-scope_lets">scope_lets</a>)</span> Bindlib.binder</span>;</code></td></tr></table><code>}</code></dt><dd><p>As a consequence, the scope_body contains only a result and input/output signature, as the other elements are stored inside the scope_let. The binder present is the argument of type <code>scope_body_input_struct</code>.</p></dd></dl><dl><dt class="spec type" id="type-scopes"><a href="#type-scopes" class="anchor"></a><code><span class="keyword">type</span> scopes</code><code> = </code><table class="variant"><tr id="type-scopes.Nil" class="anchored"><td class="def constructor"><a href="#type-scopes.Nil" class="anchor"></a><code>| </code><code><span class="constructor">Nil</span></code></td></tr><tr id="type-scopes.ScopeDef" class="anchored"><td class="def constructor"><a href="#type-scopes.ScopeDef" class="anchor"></a><code>| </code><code><span class="constructor">ScopeDef</span> <span class="keyword">of</span> </code><code>{</code><table class="record"><tr id="type-scopes.scope_name" class="anchored"><td class="def field"><a href="#type-scopes.scope_name" class="anchor"></a><code>scope_name : <a href="../Dcalc__Ast/ScopeName/index.html#type-t">D.ScopeName.t</a>;</code></td></tr><tr id="type-scopes.scope_body" class="anchored"><td class="def field"><a href="#type-scopes.scope_body" class="anchor"></a><code>scope_body : <a href="index.html#type-scope_body">scope_body</a>;</code></td></tr><tr id="type-scopes.scope_next" class="anchored"><td class="def field"><a href="#type-scopes.scope_next" class="anchor"></a><code>scope_next : <span><span>(<a href="../Dcalc/Ast/index.html#type-expr">D.expr</a>, <a href="index.html#type-scopes">scopes</a>)</span> Bindlib.binder</span>;</code></td></tr></table><code>}</code></td></tr></table></dt><dd><p>Finally, we do the same transformation for the whole program for the kinded lets. This permit us to use bindlib variables for scopes names.</p></dd></dl><dl><dt class="spec value" id="val-free_vars_list_scope_lets"><a href="#val-free_vars_list_scope_lets" class="anchor"></a><code><span class="keyword">val</span> free_vars_list_scope_lets : <a href="index.html#type-scope_lets">scope_lets</a> <span>&#45;&gt;</span> <span><a href="../Dcalc__Ast/Var/index.html#type-t">D.Var.t</a> list</span></code></dt><dd><p>List of variables not binded inside a scope_lets</p></dd></dl><dl><dt class="spec value" id="val-free_vars_list_scope_body"><a href="#val-free_vars_list_scope_body" class="anchor"></a><code><span class="keyword">val</span> free_vars_list_scope_body : <a href="index.html#type-scope_body">scope_body</a> <span>&#45;&gt;</span> <span><a href="../Dcalc__Ast/Var/index.html#type-t">D.Var.t</a> list</span></code></dt><dd><p>List of variables not binded inside a scope_body.</p></dd></dl><dl><dt class="spec value" id="val-free_vars_list_scopes"><a href="#val-free_vars_list_scopes" class="anchor"></a><code><span class="keyword">val</span> free_vars_list_scopes : <a href="index.html#type-scopes">scopes</a> <span>&#45;&gt;</span> <span><a href="../Dcalc__Ast/Var/index.html#type-t">D.Var.t</a> list</span></code></dt><dd><p>List of variables not binded inside scopes</p></dd></dl><dl><dt class="spec value" id="val-bind_scopes"><a href="#val-bind_scopes" class="anchor"></a><code><span class="keyword">val</span> bind_scopes : <span><span>(<a href="../Dcalc__Ast/ScopeName/index.html#type-t">D.ScopeName.t</a> * <span><a href="../Dcalc/Ast/index.html#type-expr">D.expr</a> Bindlib.var</span> * <a href="../Dcalc/Ast/index.html#type-scope_body">D.scope_body</a>)</span> list</span> <span>&#45;&gt;</span> <span><a href="index.html#type-scopes">scopes</a> Bindlib.box</span></code></dt><dd><p>Transform a list of scopes into our representation of scopes. It requires that scopes are topologically-well-ordered, and ensure there is no free variables in the returned <code>scopes</code></p></dd></dl></div></body></html>